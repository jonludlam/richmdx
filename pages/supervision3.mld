{0 Supervision 3}

{1 Lecture 7}

{@ocaml[
exception Missing of string

type 'a tree = | Lf | Br of 'a * 'a tree * 'a tree

let rec lookup b = function
| Br ((a, x), t1, t2) ->
    if b < a then
      lookup b t1
    else if a < b then
      lookup b t2
    else
      x
| Lf -> raise (Missing b)

let rec update k v = function
| Lf -> Br ((k, v), Lf, Lf)
| Br ((a, x), t1, t2) ->
    if k < a then
      Br ((a, x), update k v t1, t2)
    else if a < k then
      Br ((a, x), t1, update k v t2)
    else (* a = k *)
      Br ((a, v), t1, t2)

let rec string_of (str_of_alpha : 'a -> string) : 'a tree -> string = function
    | Lf -> "Lf"
    | Br(x,l,r) ->
      Printf.sprintf "Br(%s,%s,%s)"
        (str_of_alpha x)
        (string_of str_of_alpha l)
        (string_of str_of_alpha r)

let dot_escape =
  let re = Re.(compile @@ char '"') in
  fun oc s ->
    (* Allow HTML strings - put everything else in double-quotes,
       which is safe. See https://graphviz.org/doc/info/lang.html *)
    let s =
      if String.length s = 0 || s.[0] <> '<' then
        "\"" ^ Re.replace_string re ~by:"\\\"" s ^ "\""
      else
        s
    in
      output_string oc s

let printer (str_of_alpha : 'a -> string) (x : 'a tree) =
  let filename,oc = Filename.open_temp_file "tree" ".dot" in
  Printf.fprintf oc "digraph D {\n";
  let rec dump_nodes n = function
    | Lf -> Printf.fprintf oc "  Lf%d [label=\"Lf\"]\n" n
    | Br (x,t1,t2) ->
      Printf.fprintf oc "  Br%d [label=%a]\n"
        n dot_escape (str_of_alpha x);
        dump_nodes (2*n+1) t1;
        dump_nodes (2*n+2) t2
  in
  dump_nodes 0 x;
  let dump_edges t =
    let rec inner n1 n2 = function
    | Lf -> Printf.fprintf oc "  Br%d -> Lf%d\n" n1 n2
    | Br (_,t1,t2) ->
        Printf.fprintf oc "  Br%d -> Br%d\n" n1 n2;
        inner n2 (2*n2+1) t1;
        inner n2 (2*n2+2) t2
    in
    match t with
    | Lf -> ()
    | Br (_,t1,t2) -> inner 0 1 t1; inner 0 2 t2
  in
  dump_edges x;
  Printf.fprintf oc "}\n";
  close_out oc;
  let svgfile = Filename.temp_file "tree" ".svg" in
  let cmd = "dot -Tsvg -o" ^ svgfile ^ " " ^ filename in
  let _status = Sys.command cmd in
  let ic = open_in svgfile in
  let n = in_channel_length ic in
  let data = really_input_string ic n in
  close_in ic;
  Mime_printer.push "image/svg" data

let rec preorder = function
  | Lf -> []
  | Br(x,l,r) -> x :: preorder l @ preorder r
]}

{2 Exercise 7.1}

Draw the binary search tree that arises from successively inserting the following pairs
into the empty tree: ("Alice", 6), ("Tobias", 2), ("Gerald", 8), ("Lucy", 9). Then repeat
this task using the order ("Gerald", 8), ("Alice", 6), ("Lucy", 9), ("Tobias", 2). Why
are results different?

With the first order:

{@ocaml[
let vs = [("Alice", 6); ("Tobias", 2); ("Gerald", 8); ("Lucy", 9)];;

let tree = List.fold_left (fun acc (k,v) ->
    update k v acc) Lf vs;;

let _ = printer (fun (k,v) -> Printf.sprintf "%s -> %d" k v) tree;;
][
{%html: <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: D Pages: 1 -->
<svg width="224pt" height="332pt"
 viewBox="0.00 0.00 224.00 332.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>D</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-328 220,-328 220,4 -4,4"/>
<!-- Br0 -->
<g id="node1" class="node">
<title>Br0</title>
<ellipse fill="none" stroke="black" cx="81" cy="-306" rx="55.79" ry="18"/>
<text text-anchor="middle" x="81" y="-302.3" font-family="Times,serif" font-size="14.00">Alice &#45;&gt; 6</text>
</g>
<!-- Lf1 -->
<g id="node2" class="node">
<title>Lf1</title>
<ellipse fill="none" stroke="black" cx="27" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-230.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br0&#45;&gt;Lf1 -->
<g id="edge1" class="edge">
<title>Br0&#45;&gt;Lf1</title>
<path fill="none" stroke="black" d="M68.2,-288.41C61.35,-279.53 52.8,-268.44 45.26,-258.67"/>
<polygon fill="black" stroke="black" points="47.84,-256.29 38.97,-250.51 42.3,-260.57 47.84,-256.29"/>
</g>
<!-- Br2 -->
<g id="node3" class="node">
<title>Br2</title>
<ellipse fill="none" stroke="black" cx="135" cy="-234" rx="63.09" ry="18"/>
<text text-anchor="middle" x="135" y="-230.3" font-family="Times,serif" font-size="14.00">Tobias &#45;&gt; 2</text>
</g>
<!-- Br0&#45;&gt;Br2 -->
<g id="edge2" class="edge">
<title>Br0&#45;&gt;Br2</title>
<path fill="none" stroke="black" d="M93.8,-288.41C100.36,-279.91 108.48,-269.37 115.78,-259.91"/>
<polygon fill="black" stroke="black" points="118.58,-262.01 121.92,-251.96 113.04,-257.74 118.58,-262.01"/>
</g>
<!-- Br5 -->
<g id="node4" class="node">
<title>Br5</title>
<ellipse fill="none" stroke="black" cx="80" cy="-162" rx="64.19" ry="18"/>
<text text-anchor="middle" x="80" y="-158.3" font-family="Times,serif" font-size="14.00">Gerald &#45;&gt; 8</text>
</g>
<!-- Br2&#45;&gt;Br5 -->
<g id="edge3" class="edge">
<title>Br2&#45;&gt;Br5</title>
<path fill="none" stroke="black" d="M121.69,-216.05C115,-207.54 106.77,-197.07 99.39,-187.68"/>
<polygon fill="black" stroke="black" points="102.12,-185.49 93.19,-179.79 96.62,-189.81 102.12,-185.49"/>
</g>
<!-- Lf6 -->
<g id="node9" class="node">
<title>Lf6</title>
<ellipse fill="none" stroke="black" cx="189" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="189" y="-158.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br2&#45;&gt;Lf6 -->
<g id="edge8" class="edge">
<title>Br2&#45;&gt;Lf6</title>
<path fill="none" stroke="black" d="M148.07,-216.05C154.93,-207.17 163.43,-196.14 170.91,-186.45"/>
<polygon fill="black" stroke="black" points="173.82,-188.41 177.15,-178.36 168.27,-184.14 173.82,-188.41"/>
</g>
<!-- Lf11 -->
<g id="node5" class="node">
<title>Lf11</title>
<ellipse fill="none" stroke="black" cx="30" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="30" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br5&#45;&gt;Lf11 -->
<g id="edge4" class="edge">
<title>Br5&#45;&gt;Lf11</title>
<path fill="none" stroke="black" d="M67.9,-144.05C61.7,-135.38 54.05,-124.67 47.25,-115.15"/>
<polygon fill="black" stroke="black" points="49.97,-112.93 41.31,-106.83 44.27,-117 49.97,-112.93"/>
</g>
<!-- Br12 -->
<g id="node6" class="node">
<title>Br12</title>
<ellipse fill="none" stroke="black" cx="130" cy="-90" rx="55.49" ry="18"/>
<text text-anchor="middle" x="130" y="-86.3" font-family="Times,serif" font-size="14.00">Lucy &#45;&gt; 9</text>
</g>
<!-- Br5&#45;&gt;Br12 -->
<g id="edge5" class="edge">
<title>Br5&#45;&gt;Br12</title>
<path fill="none" stroke="black" d="M92.1,-144.05C98.12,-135.63 105.51,-125.28 112.17,-115.97"/>
<polygon fill="black" stroke="black" points="115.04,-117.96 118.01,-107.79 109.35,-113.89 115.04,-117.96"/>
</g>
<!-- Lf25 -->
<g id="node7" class="node">
<title>Lf25</title>
<ellipse fill="none" stroke="black" cx="94" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="94" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br12&#45;&gt;Lf25 -->
<g id="edge6" class="edge">
<title>Br12&#45;&gt;Lf25</title>
<path fill="none" stroke="black" d="M121.29,-72.05C117.02,-63.77 111.8,-53.62 107.08,-44.42"/>
<polygon fill="black" stroke="black" points="110.07,-42.6 102.39,-35.31 103.85,-45.8 110.07,-42.6"/>
</g>
<!-- Lf26 -->
<g id="node8" class="node">
<title>Lf26</title>
<ellipse fill="none" stroke="black" cx="166" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="166" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br12&#45;&gt;Lf26 -->
<g id="edge7" class="edge">
<title>Br12&#45;&gt;Lf26</title>
<path fill="none" stroke="black" d="M138.71,-72.05C142.98,-63.77 148.2,-53.62 152.92,-44.42"/>
<polygon fill="black" stroke="black" points="156.15,-45.8 157.61,-35.31 149.93,-42.6 156.15,-45.8"/>
</g>
</g>
</svg>
 %}
]}

Second order:

{@ocaml[
let vs = [("Gerald", 8); ("Alice", 6); ("Lucy", 9); ("Tobias", 2)];;

let tree = List.fold_left (fun acc (k,v) ->
    update k v acc) Lf vs;;

let _ = printer (fun (k,v) -> Printf.sprintf "%s -> %d" k v) tree;;
][
{%html: <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: D Pages: 1 -->
<svg width="378pt" height="260pt"
 viewBox="0.00 0.00 378.04 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)">
<title>D</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-256 374.04,-256 374.04,4 -4,4"/>
<!-- Br0 -->
<g id="node1" class="node">
<title>Br0</title>
<ellipse fill="none" stroke="black" cx="148" cy="-234" rx="64.19" ry="18"/>
<text text-anchor="middle" x="148" y="-230.3" font-family="Times,serif" font-size="14.00">Gerald &#45;&gt; 8</text>
</g>
<!-- Br1 -->
<g id="node2" class="node">
<title>Br1</title>
<ellipse fill="none" stroke="black" cx="84" cy="-162" rx="55.79" ry="18"/>
<text text-anchor="middle" x="84" y="-158.3" font-family="Times,serif" font-size="14.00">Alice &#45;&gt; 6</text>
</g>
<!-- Br0&#45;&gt;Br1 -->
<g id="edge1" class="edge">
<title>Br0&#45;&gt;Br1</title>
<path fill="none" stroke="black" d="M132.83,-216.41C124.78,-207.61 114.75,-196.63 105.87,-186.92"/>
<polygon fill="black" stroke="black" points="108.39,-184.49 99.06,-179.47 103.22,-189.21 108.39,-184.49"/>
</g>
<!-- Br2 -->
<g id="node5" class="node">
<title>Br2</title>
<ellipse fill="none" stroke="black" cx="213" cy="-162" rx="55.49" ry="18"/>
<text text-anchor="middle" x="213" y="-158.3" font-family="Times,serif" font-size="14.00">Lucy &#45;&gt; 9</text>
</g>
<!-- Br0&#45;&gt;Br2 -->
<g id="edge4" class="edge">
<title>Br0&#45;&gt;Br2</title>
<path fill="none" stroke="black" d="M163.4,-216.41C171.58,-207.61 181.77,-196.63 190.79,-186.92"/>
<polygon fill="black" stroke="black" points="193.47,-189.18 197.71,-179.47 188.34,-184.42 193.47,-189.18"/>
</g>
<!-- Lf3 -->
<g id="node3" class="node">
<title>Lf3</title>
<ellipse fill="none" stroke="black" cx="27" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br1&#45;&gt;Lf3 -->
<g id="edge2" class="edge">
<title>Br1&#45;&gt;Lf3</title>
<path fill="none" stroke="black" d="M70.49,-144.41C63.19,-135.44 54.05,-124.21 46.03,-114.37"/>
<polygon fill="black" stroke="black" points="48.66,-112.06 39.63,-106.51 43.23,-116.48 48.66,-112.06"/>
</g>
<!-- Lf4 -->
<g id="node4" class="node">
<title>Lf4</title>
<ellipse fill="none" stroke="black" cx="99" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br1&#45;&gt;Lf4 -->
<g id="edge3" class="edge">
<title>Br1&#45;&gt;Lf4</title>
<path fill="none" stroke="black" d="M87.71,-143.7C89.36,-135.98 91.35,-126.71 93.19,-118.11"/>
<polygon fill="black" stroke="black" points="96.66,-118.62 95.33,-108.1 89.82,-117.15 96.66,-118.62"/>
</g>
<!-- Lf5 -->
<g id="node6" class="node">
<title>Lf5</title>
<ellipse fill="none" stroke="black" cx="199" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="199" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br2&#45;&gt;Lf5 -->
<g id="edge5" class="edge">
<title>Br2&#45;&gt;Lf5</title>
<path fill="none" stroke="black" d="M209.54,-143.7C208,-135.98 206.14,-126.71 204.42,-118.11"/>
<polygon fill="black" stroke="black" points="207.81,-117.22 202.42,-108.1 200.95,-118.6 207.81,-117.22"/>
</g>
<!-- Br6 -->
<g id="node7" class="node">
<title>Br6</title>
<ellipse fill="none" stroke="black" cx="307" cy="-90" rx="63.09" ry="18"/>
<text text-anchor="middle" x="307" y="-86.3" font-family="Times,serif" font-size="14.00">Tobias &#45;&gt; 2</text>
</g>
<!-- Br2&#45;&gt;Br6 -->
<g id="edge6" class="edge">
<title>Br2&#45;&gt;Br6</title>
<path fill="none" stroke="black" d="M234.33,-145.12C246.98,-135.7 263.21,-123.61 277.12,-113.25"/>
<polygon fill="black" stroke="black" points="279.5,-115.84 285.43,-107.06 275.32,-110.23 279.5,-115.84"/>
</g>
<!-- Lf13 -->
<g id="node8" class="node">
<title>Lf13</title>
<ellipse fill="none" stroke="black" cx="271" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="271" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br6&#45;&gt;Lf13 -->
<g id="edge7" class="edge">
<title>Br6&#45;&gt;Lf13</title>
<path fill="none" stroke="black" d="M298.29,-72.05C294.02,-63.77 288.8,-53.62 284.08,-44.42"/>
<polygon fill="black" stroke="black" points="287.07,-42.6 279.39,-35.31 280.85,-45.8 287.07,-42.6"/>
</g>
<!-- Lf14 -->
<g id="node9" class="node">
<title>Lf14</title>
<ellipse fill="none" stroke="black" cx="343" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="343" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br6&#45;&gt;Lf14 -->
<g id="edge8" class="edge">
<title>Br6&#45;&gt;Lf14</title>
<path fill="none" stroke="black" d="M315.71,-72.05C319.98,-63.77 325.2,-53.62 329.92,-44.42"/>
<polygon fill="black" stroke="black" points="333.15,-45.8 334.61,-35.31 326.93,-42.6 333.15,-45.8"/>
</g>
</g>
</svg>
 %}
]}

 The order clearly matters. This is because each time an item is inserted, the position in the tree is dictated by the key-value
 pairs that are already present in the tree.


{2 Exercise 7.2}

Code an insertion function for binary search trees. It should resemble the existing update function except that it should raise the exception Collision if the item to be inserted is already present.

{@ocaml[
exception Collision

let rec insert k v = function
| Lf -> Br ((k, v), Lf, Lf)
| Br ((a, x), t1, t2) ->
    if k < a then
      Br ((a, x), insert k v t1, t2)
    else if a < k then
      Br ((a, x), t1, insert k v t2)
    else (* a = k *)
      raise Collision
]}

{@ocaml[
# let tree = insert "Alice" 8 Lf;;
val tree : (string * int) tree = Br (("Alice", 8), Lf, Lf)
# let tree = insert "Alice" 9 tree;;
Exception: Collision.
]}

{2 Exercise 7.3}

Continuing the previous exercise, it would be natural for exceptional Collision to return the value previously stored in the dictionary. Why is that goal difficult to achieve?

This is tricky since trees are currently polymorphic, and exceptions can't be. Could use a result though. A result is:

{@ocaml skip[type ('a, 'b) result = Ok of 'a | Error of 'b]}

and [Result.bind] is:

{@ocaml[let bind x f = match x with | Ok y -> f y | Error z -> Error z]}

{@ocaml[
let rec insert k v =
  function
  | Lf -> Ok (Br ((k, v), Lf, Lf))
  | Br ((a, x), t1, t2) ->
    if k < a then
      bind (insert k v t1) (fun lhs ->
      Ok (Br ((a, x), lhs, t2)))
    else if a < k then
      bind (insert k v t2) (fun rhs ->
      Ok (Br ((a, x), t1, rhs)))
    else (* a = k *)
      Error x
]}


{@ocaml[
# let t = insert "foo" "bar" Lf |> Result.get_ok;;
val t : (string * string) tree = Br (("foo", "bar"), Lf, Lf)
# let t' = insert "foo" "baz" t;;
val t' : ((string * string) tree, string) result = Error "bar"
# let t = insert "foo" 1 Lf |> Result.get_ok;;
val t : (string * int) tree = Br (("foo", 1), Lf, Lf)
# let t' = insert "foo" 2 t;;
val t' : ((string * int) tree, int) result = Error 1
]}

{2 Exercise 7.4}

Describe an algorithm for deleting an entry from a binary search tree. Comment on the suitability of
your approach.

Like update, except different behaviour upon finding the case [a=k]. In this case, we examine the children:
- Both leaves - then return [Lf]
- One leaf, one branch, return the branch.
- Two branches, Find and remove the maximum node in the LH branch, use that as our new node, with RHS from before, and LHS the modified tree

{2 Exercise 7.5}

{@ocaml[
exception Collision

let rec remove_and_return_max = fun x lh rh ->
    match rh with
    | Lf -> (x, lh)
    | Br (y, lh', rh') ->
        let (x', rh'') = remove_and_return_max y lh' rh' in
        (x', Br (x, lh, rh''))

let rec remove k = function
| Lf -> Lf
| Br ((a, x), t1, t2) ->
    if k < a then
      Br ((a, x), remove k t1, t2)
    else if a < k then
      Br ((a, x), t1, remove k t2)
    else
      match (t1, t2) with
      | Lf, Lf -> Lf
      | Br _, Lf -> t1
      | Lf, Br _ -> t2
      | Br (a, l1, l2), Br _ ->
        let (max, lh') = remove_and_return_max a l1 l2 in
        Br (max, lh', t2)

let test_vals = [(10,0);(5,0);(15,0);(14,0);(16,0);(9,0);(8,0);(4,0)];;
let test_tree = List.fold_left (fun t (k,v) -> update k v t) Lf test_vals;;
let _ = printer (fun (x, _) -> string_of_int x) test_tree;;
][
{%html: <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: D Pages: 1 -->
<svg width="566pt" height="332pt"
 viewBox="0.00 0.00 566.00 332.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>D</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-328 562,-328 562,4 -4,4"/>
<!-- Br0 -->
<g id="node1" class="node">
<title>Br0</title>
<ellipse fill="none" stroke="black" cx="279" cy="-306" rx="27" ry="18"/>
<text text-anchor="middle" x="279" y="-302.3" font-family="Times,serif" font-size="14.00">10</text>
</g>
<!-- Br1 -->
<g id="node2" class="node">
<title>Br1</title>
<ellipse fill="none" stroke="black" cx="207" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="207" y="-230.3" font-family="Times,serif" font-size="14.00">5</text>
</g>
<!-- Br0&#45;&gt;Br1 -->
<g id="edge1" class="edge">
<title>Br0&#45;&gt;Br1</title>
<path fill="none" stroke="black" d="M264.43,-290.83C254.25,-280.94 240.48,-267.55 228.97,-256.36"/>
<polygon fill="black" stroke="black" points="231.41,-253.85 221.8,-249.38 226.53,-258.87 231.41,-253.85"/>
</g>
<!-- Br2 -->
<g id="node11" class="node">
<title>Br2</title>
<ellipse fill="none" stroke="black" cx="351" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="351" y="-230.3" font-family="Times,serif" font-size="14.00">15</text>
</g>
<!-- Br0&#45;&gt;Br2 -->
<g id="edge10" class="edge">
<title>Br0&#45;&gt;Br2</title>
<path fill="none" stroke="black" d="M293.57,-290.83C303.75,-280.94 317.52,-267.55 329.03,-256.36"/>
<polygon fill="black" stroke="black" points="331.47,-258.87 336.2,-249.38 326.59,-253.85 331.47,-258.87"/>
</g>
<!-- Br3 -->
<g id="node3" class="node">
<title>Br3</title>
<ellipse fill="none" stroke="black" cx="99" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-158.3" font-family="Times,serif" font-size="14.00">4</text>
</g>
<!-- Br1&#45;&gt;Br3 -->
<g id="edge2" class="edge">
<title>Br1&#45;&gt;Br3</title>
<path fill="none" stroke="black" d="M188.19,-220.81C171,-209.67 145.38,-193.06 126.01,-180.5"/>
<polygon fill="black" stroke="black" points="127.89,-177.56 117.6,-175.05 124.08,-183.43 127.89,-177.56"/>
</g>
<!-- Br4 -->
<g id="node6" class="node">
<title>Br4</title>
<ellipse fill="none" stroke="black" cx="207" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="207" y="-158.3" font-family="Times,serif" font-size="14.00">9</text>
</g>
<!-- Br1&#45;&gt;Br4 -->
<g id="edge5" class="edge">
<title>Br1&#45;&gt;Br4</title>
<path fill="none" stroke="black" d="M207,-215.7C207,-207.98 207,-198.71 207,-190.11"/>
<polygon fill="black" stroke="black" points="210.5,-190.1 207,-180.1 203.5,-190.1 210.5,-190.1"/>
</g>
<!-- Lf7 -->
<g id="node4" class="node">
<title>Lf7</title>
<ellipse fill="none" stroke="black" cx="27" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br3&#45;&gt;Lf7 -->
<g id="edge3" class="edge">
<title>Br3&#45;&gt;Lf7</title>
<path fill="none" stroke="black" d="M84.43,-146.83C74.25,-136.94 60.48,-123.55 48.97,-112.36"/>
<polygon fill="black" stroke="black" points="51.41,-109.85 41.8,-105.38 46.53,-114.87 51.41,-109.85"/>
</g>
<!-- Lf8 -->
<g id="node5" class="node">
<title>Lf8</title>
<ellipse fill="none" stroke="black" cx="99" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br3&#45;&gt;Lf8 -->
<g id="edge4" class="edge">
<title>Br3&#45;&gt;Lf8</title>
<path fill="none" stroke="black" d="M99,-143.7C99,-135.98 99,-126.71 99,-118.11"/>
<polygon fill="black" stroke="black" points="102.5,-118.1 99,-108.1 95.5,-118.1 102.5,-118.1"/>
</g>
<!-- Br9 -->
<g id="node7" class="node">
<title>Br9</title>
<ellipse fill="none" stroke="black" cx="171" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="171" y="-86.3" font-family="Times,serif" font-size="14.00">8</text>
</g>
<!-- Br4&#45;&gt;Br9 -->
<g id="edge6" class="edge">
<title>Br4&#45;&gt;Br9</title>
<path fill="none" stroke="black" d="M198.65,-144.76C194.29,-136.28 188.85,-125.71 183.96,-116.2"/>
<polygon fill="black" stroke="black" points="186.99,-114.44 179.3,-107.15 180.77,-117.64 186.99,-114.44"/>
</g>
<!-- Lf10 -->
<g id="node10" class="node">
<title>Lf10</title>
<ellipse fill="none" stroke="black" cx="243" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="243" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br4&#45;&gt;Lf10 -->
<g id="edge9" class="edge">
<title>Br4&#45;&gt;Lf10</title>
<path fill="none" stroke="black" d="M215.35,-144.76C219.71,-136.28 225.15,-125.71 230.04,-116.2"/>
<polygon fill="black" stroke="black" points="233.23,-117.64 234.7,-107.15 227.01,-114.44 233.23,-117.64"/>
</g>
<!-- Lf19 -->
<g id="node8" class="node">
<title>Lf19</title>
<ellipse fill="none" stroke="black" cx="135" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="135" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br9&#45;&gt;Lf19 -->
<g id="edge7" class="edge">
<title>Br9&#45;&gt;Lf19</title>
<path fill="none" stroke="black" d="M162.65,-72.76C158.29,-64.28 152.85,-53.71 147.96,-44.2"/>
<polygon fill="black" stroke="black" points="150.99,-42.44 143.3,-35.15 144.77,-45.64 150.99,-42.44"/>
</g>
<!-- Lf20 -->
<g id="node9" class="node">
<title>Lf20</title>
<ellipse fill="none" stroke="black" cx="207" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="207" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br9&#45;&gt;Lf20 -->
<g id="edge8" class="edge">
<title>Br9&#45;&gt;Lf20</title>
<path fill="none" stroke="black" d="M179.35,-72.76C183.71,-64.28 189.15,-53.71 194.04,-44.2"/>
<polygon fill="black" stroke="black" points="197.23,-45.64 198.7,-35.15 191.01,-42.44 197.23,-45.64"/>
</g>
<!-- Br5 -->
<g id="node12" class="node">
<title>Br5</title>
<ellipse fill="none" stroke="black" cx="351" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="351" y="-158.3" font-family="Times,serif" font-size="14.00">14</text>
</g>
<!-- Br2&#45;&gt;Br5 -->
<g id="edge11" class="edge">
<title>Br2&#45;&gt;Br5</title>
<path fill="none" stroke="black" d="M351,-215.7C351,-207.98 351,-198.71 351,-190.11"/>
<polygon fill="black" stroke="black" points="354.5,-190.1 351,-180.1 347.5,-190.1 354.5,-190.1"/>
</g>
<!-- Br6 -->
<g id="node15" class="node">
<title>Br6</title>
<ellipse fill="none" stroke="black" cx="459" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="459" y="-158.3" font-family="Times,serif" font-size="14.00">16</text>
</g>
<!-- Br2&#45;&gt;Br6 -->
<g id="edge14" class="edge">
<title>Br2&#45;&gt;Br6</title>
<path fill="none" stroke="black" d="M369.81,-220.81C387,-209.67 412.62,-193.06 431.99,-180.5"/>
<polygon fill="black" stroke="black" points="433.92,-183.43 440.4,-175.05 430.11,-177.56 433.92,-183.43"/>
</g>
<!-- Lf11 -->
<g id="node13" class="node">
<title>Lf11</title>
<ellipse fill="none" stroke="black" cx="315" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="315" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br5&#45;&gt;Lf11 -->
<g id="edge12" class="edge">
<title>Br5&#45;&gt;Lf11</title>
<path fill="none" stroke="black" d="M342.65,-144.76C338.29,-136.28 332.85,-125.71 327.96,-116.2"/>
<polygon fill="black" stroke="black" points="330.99,-114.44 323.3,-107.15 324.77,-117.64 330.99,-114.44"/>
</g>
<!-- Lf12 -->
<g id="node14" class="node">
<title>Lf12</title>
<ellipse fill="none" stroke="black" cx="387" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="387" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br5&#45;&gt;Lf12 -->
<g id="edge13" class="edge">
<title>Br5&#45;&gt;Lf12</title>
<path fill="none" stroke="black" d="M359.35,-144.76C363.71,-136.28 369.15,-125.71 374.04,-116.2"/>
<polygon fill="black" stroke="black" points="377.23,-117.64 378.7,-107.15 371.01,-114.44 377.23,-117.64"/>
</g>
<!-- Lf13 -->
<g id="node16" class="node">
<title>Lf13</title>
<ellipse fill="none" stroke="black" cx="459" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="459" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br6&#45;&gt;Lf13 -->
<g id="edge15" class="edge">
<title>Br6&#45;&gt;Lf13</title>
<path fill="none" stroke="black" d="M459,-143.7C459,-135.98 459,-126.71 459,-118.11"/>
<polygon fill="black" stroke="black" points="462.5,-118.1 459,-108.1 455.5,-118.1 462.5,-118.1"/>
</g>
<!-- Lf14 -->
<g id="node17" class="node">
<title>Lf14</title>
<ellipse fill="none" stroke="black" cx="531" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="531" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br6&#45;&gt;Lf14 -->
<g id="edge16" class="edge">
<title>Br6&#45;&gt;Lf14</title>
<path fill="none" stroke="black" d="M473.57,-146.83C483.75,-136.94 497.52,-123.55 509.03,-112.36"/>
<polygon fill="black" stroke="black" points="511.47,-114.87 516.2,-105.38 506.59,-109.85 511.47,-114.87"/>
</g>
</g>
</svg>
 %}
]}

{@ocaml[
let test_tree' = remove 10 test_tree;;
let _ = printer (fun (x, _) -> string_of_int x) test_tree';;
][
{%html: <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: D Pages: 1 -->
<svg width="566pt" height="260pt"
 viewBox="0.00 0.00 566.00 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)">
<title>D</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-256 562,-256 562,4 -4,4"/>
<!-- Br0 -->
<g id="node1" class="node">
<title>Br0</title>
<ellipse fill="none" stroke="black" cx="279" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="279" y="-230.3" font-family="Times,serif" font-size="14.00">9</text>
</g>
<!-- Br1 -->
<g id="node2" class="node">
<title>Br1</title>
<ellipse fill="none" stroke="black" cx="207" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="207" y="-158.3" font-family="Times,serif" font-size="14.00">5</text>
</g>
<!-- Br0&#45;&gt;Br1 -->
<g id="edge1" class="edge">
<title>Br0&#45;&gt;Br1</title>
<path fill="none" stroke="black" d="M264.43,-218.83C254.25,-208.94 240.48,-195.55 228.97,-184.36"/>
<polygon fill="black" stroke="black" points="231.41,-181.85 221.8,-177.38 226.53,-186.87 231.41,-181.85"/>
</g>
<!-- Br2 -->
<g id="node9" class="node">
<title>Br2</title>
<ellipse fill="none" stroke="black" cx="351" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="351" y="-158.3" font-family="Times,serif" font-size="14.00">15</text>
</g>
<!-- Br0&#45;&gt;Br2 -->
<g id="edge8" class="edge">
<title>Br0&#45;&gt;Br2</title>
<path fill="none" stroke="black" d="M293.57,-218.83C303.75,-208.94 317.52,-195.55 329.03,-184.36"/>
<polygon fill="black" stroke="black" points="331.47,-186.87 336.2,-177.38 326.59,-181.85 331.47,-186.87"/>
</g>
<!-- Br3 -->
<g id="node3" class="node">
<title>Br3</title>
<ellipse fill="none" stroke="black" cx="99" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-86.3" font-family="Times,serif" font-size="14.00">4</text>
</g>
<!-- Br1&#45;&gt;Br3 -->
<g id="edge2" class="edge">
<title>Br1&#45;&gt;Br3</title>
<path fill="none" stroke="black" d="M188.19,-148.81C171,-137.67 145.38,-121.06 126.01,-108.5"/>
<polygon fill="black" stroke="black" points="127.89,-105.56 117.6,-103.05 124.08,-111.43 127.89,-105.56"/>
</g>
<!-- Br4 -->
<g id="node6" class="node">
<title>Br4</title>
<ellipse fill="none" stroke="black" cx="207" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="207" y="-86.3" font-family="Times,serif" font-size="14.00">8</text>
</g>
<!-- Br1&#45;&gt;Br4 -->
<g id="edge5" class="edge">
<title>Br1&#45;&gt;Br4</title>
<path fill="none" stroke="black" d="M207,-143.7C207,-135.98 207,-126.71 207,-118.11"/>
<polygon fill="black" stroke="black" points="210.5,-118.1 207,-108.1 203.5,-118.1 210.5,-118.1"/>
</g>
<!-- Lf7 -->
<g id="node4" class="node">
<title>Lf7</title>
<ellipse fill="none" stroke="black" cx="27" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br3&#45;&gt;Lf7 -->
<g id="edge3" class="edge">
<title>Br3&#45;&gt;Lf7</title>
<path fill="none" stroke="black" d="M84.43,-74.83C74.25,-64.94 60.48,-51.55 48.97,-40.36"/>
<polygon fill="black" stroke="black" points="51.41,-37.85 41.8,-33.38 46.53,-42.87 51.41,-37.85"/>
</g>
<!-- Lf8 -->
<g id="node5" class="node">
<title>Lf8</title>
<ellipse fill="none" stroke="black" cx="99" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br3&#45;&gt;Lf8 -->
<g id="edge4" class="edge">
<title>Br3&#45;&gt;Lf8</title>
<path fill="none" stroke="black" d="M99,-71.7C99,-63.98 99,-54.71 99,-46.11"/>
<polygon fill="black" stroke="black" points="102.5,-46.1 99,-36.1 95.5,-46.1 102.5,-46.1"/>
</g>
<!-- Lf9 -->
<g id="node7" class="node">
<title>Lf9</title>
<ellipse fill="none" stroke="black" cx="171" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="171" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br4&#45;&gt;Lf9 -->
<g id="edge6" class="edge">
<title>Br4&#45;&gt;Lf9</title>
<path fill="none" stroke="black" d="M198.65,-72.76C194.29,-64.28 188.85,-53.71 183.96,-44.2"/>
<polygon fill="black" stroke="black" points="186.99,-42.44 179.3,-35.15 180.77,-45.64 186.99,-42.44"/>
</g>
<!-- Lf10 -->
<g id="node8" class="node">
<title>Lf10</title>
<ellipse fill="none" stroke="black" cx="243" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="243" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br4&#45;&gt;Lf10 -->
<g id="edge7" class="edge">
<title>Br4&#45;&gt;Lf10</title>
<path fill="none" stroke="black" d="M215.35,-72.76C219.71,-64.28 225.15,-53.71 230.04,-44.2"/>
<polygon fill="black" stroke="black" points="233.23,-45.64 234.7,-35.15 227.01,-42.44 233.23,-45.64"/>
</g>
<!-- Br5 -->
<g id="node10" class="node">
<title>Br5</title>
<ellipse fill="none" stroke="black" cx="351" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="351" y="-86.3" font-family="Times,serif" font-size="14.00">14</text>
</g>
<!-- Br2&#45;&gt;Br5 -->
<g id="edge9" class="edge">
<title>Br2&#45;&gt;Br5</title>
<path fill="none" stroke="black" d="M351,-143.7C351,-135.98 351,-126.71 351,-118.11"/>
<polygon fill="black" stroke="black" points="354.5,-118.1 351,-108.1 347.5,-118.1 354.5,-118.1"/>
</g>
<!-- Br6 -->
<g id="node13" class="node">
<title>Br6</title>
<ellipse fill="none" stroke="black" cx="459" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="459" y="-86.3" font-family="Times,serif" font-size="14.00">16</text>
</g>
<!-- Br2&#45;&gt;Br6 -->
<g id="edge12" class="edge">
<title>Br2&#45;&gt;Br6</title>
<path fill="none" stroke="black" d="M369.81,-148.81C387,-137.67 412.62,-121.06 431.99,-108.5"/>
<polygon fill="black" stroke="black" points="433.92,-111.43 440.4,-103.05 430.11,-105.56 433.92,-111.43"/>
</g>
<!-- Lf11 -->
<g id="node11" class="node">
<title>Lf11</title>
<ellipse fill="none" stroke="black" cx="315" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="315" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br5&#45;&gt;Lf11 -->
<g id="edge10" class="edge">
<title>Br5&#45;&gt;Lf11</title>
<path fill="none" stroke="black" d="M342.65,-72.76C338.29,-64.28 332.85,-53.71 327.96,-44.2"/>
<polygon fill="black" stroke="black" points="330.99,-42.44 323.3,-35.15 324.77,-45.64 330.99,-42.44"/>
</g>
<!-- Lf12 -->
<g id="node12" class="node">
<title>Lf12</title>
<ellipse fill="none" stroke="black" cx="387" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="387" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br5&#45;&gt;Lf12 -->
<g id="edge11" class="edge">
<title>Br5&#45;&gt;Lf12</title>
<path fill="none" stroke="black" d="M359.35,-72.76C363.71,-64.28 369.15,-53.71 374.04,-44.2"/>
<polygon fill="black" stroke="black" points="377.23,-45.64 378.7,-35.15 371.01,-42.44 377.23,-45.64"/>
</g>
<!-- Lf13 -->
<g id="node14" class="node">
<title>Lf13</title>
<ellipse fill="none" stroke="black" cx="459" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="459" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br6&#45;&gt;Lf13 -->
<g id="edge13" class="edge">
<title>Br6&#45;&gt;Lf13</title>
<path fill="none" stroke="black" d="M459,-71.7C459,-63.98 459,-54.71 459,-46.11"/>
<polygon fill="black" stroke="black" points="462.5,-46.1 459,-36.1 455.5,-46.1 462.5,-46.1"/>
</g>
<!-- Lf14 -->
<g id="node15" class="node">
<title>Lf14</title>
<ellipse fill="none" stroke="black" cx="531" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="531" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br6&#45;&gt;Lf14 -->
<g id="edge14" class="edge">
<title>Br6&#45;&gt;Lf14</title>
<path fill="none" stroke="black" d="M473.57,-74.83C483.75,-64.94 497.52,-51.55 509.03,-40.36"/>
<polygon fill="black" stroke="black" points="511.47,-42.87 516.2,-33.38 506.59,-37.85 511.47,-42.87"/>
</g>
</g>
</svg>
 %}
]}


{2 Exercise 7.6}

Show that the functions [preorder], [inorder] and [postorder] all require {m O(n^2)} time in the worst
case, where {m n} is the size of the tree.

{@ocaml[
let rec preorder = function
 | Lf -> []
 | Br (v, t1, t2) ->
   [v] @ preorder t1 @ preorder t2
]}

Clearly the worst case in this function is when "tree" is effectively a list down the left-hand branch. In this case,
[preorder t1] will be the length of the size {m n} of the tree. As list append is {m O(n)} where {m n} is the length
of the first argument of append, this means that at each node of the tree, an append is done of space/time complexity
equal to the size of the subtree. Thus for n nodes of the tree, doing n work at each node, the total complexity is
{m O(n^2)}.

{2 Exercise 7.7}

{@ocaml[
let rec preord = function
| Lf, vs -> vs
| Br (v, t1, t2), vs ->
    v :: preord (t1, preord (t2, vs))
]}

In contrast, [preord] here visits each node once, doing {m O(1)} work at each point (the cons operation). Therefore
its complexity is {m O(n)}.

{2 Exercise 7.8}

Let's look at the trees that result from removing the top element:

{@ocaml[
exception Subscript;;

let rec update = function
| Lf, k, w ->
    if k = 1 then
      Br (w, Lf, Lf)
    else
      raise Subscript  (* Gap in tree *)
| Br (v, t1, t2), k, w ->
    if k = 1 then
      Br (w, t1, t2)
    else if k mod 2 = 0 then
      Br (v, update (t1, k / 2, w), t2)
    else
      Br (v, t1, update (t2, k / 2, w));;

let t =
  let list = List.init 16 (fun i -> i+1) in
  List.fold_left (fun t i -> update (t, i, i)) Lf list;;

let _ =
  printer string_of_int t;;
][
{%html: <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: D Pages: 1 -->
<svg width="1178pt" height="404pt"
 viewBox="0.00 0.00 1178.00 404.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 400)">
<title>D</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-400 1174,-400 1174,4 -4,4"/>
<!-- Br0 -->
<g id="node1" class="node">
<title>Br0</title>
<ellipse fill="none" stroke="black" cx="639" cy="-378" rx="27" ry="18"/>
<text text-anchor="middle" x="639" y="-374.3" font-family="Times,serif" font-size="14.00">1</text>
</g>
<!-- Br1 -->
<g id="node2" class="node">
<title>Br1</title>
<ellipse fill="none" stroke="black" cx="459" cy="-306" rx="27" ry="18"/>
<text text-anchor="middle" x="459" y="-302.3" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- Br0&#45;&gt;Br1 -->
<g id="edge1" class="edge">
<title>Br0&#45;&gt;Br1</title>
<path fill="none" stroke="black" d="M616.2,-368.13C584.64,-355.86 527.46,-333.62 491.45,-319.62"/>
<polygon fill="black" stroke="black" points="492.48,-316.27 481.9,-315.9 489.95,-322.79 492.48,-316.27"/>
</g>
<!-- Br2 -->
<g id="node19" class="node">
<title>Br2</title>
<ellipse fill="none" stroke="black" cx="747" cy="-306" rx="27" ry="18"/>
<text text-anchor="middle" x="747" y="-302.3" font-family="Times,serif" font-size="14.00">3</text>
</g>
<!-- Br0&#45;&gt;Br2 -->
<g id="edge18" class="edge">
<title>Br0&#45;&gt;Br2</title>
<path fill="none" stroke="black" d="M657.81,-364.81C675,-353.67 700.62,-337.06 719.99,-324.5"/>
<polygon fill="black" stroke="black" points="721.92,-327.43 728.4,-319.05 718.11,-321.56 721.92,-327.43"/>
</g>
<!-- Br3 -->
<g id="node3" class="node">
<title>Br3</title>
<ellipse fill="none" stroke="black" cx="243" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="243" y="-230.3" font-family="Times,serif" font-size="14.00">4</text>
</g>
<!-- Br1&#45;&gt;Br3 -->
<g id="edge2" class="edge">
<title>Br1&#45;&gt;Br3</title>
<path fill="none" stroke="black" d="M435.06,-297.24C396.44,-284.73 320.28,-260.05 276.36,-245.81"/>
<polygon fill="black" stroke="black" points="277.31,-242.44 266.72,-242.69 275.15,-249.1 277.31,-242.44"/>
</g>
<!-- Br4 -->
<g id="node12" class="node">
<title>Br4</title>
<ellipse fill="none" stroke="black" cx="459" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="459" y="-230.3" font-family="Times,serif" font-size="14.00">6</text>
</g>
<!-- Br1&#45;&gt;Br4 -->
<g id="edge11" class="edge">
<title>Br1&#45;&gt;Br4</title>
<path fill="none" stroke="black" d="M459,-287.7C459,-279.98 459,-270.71 459,-262.11"/>
<polygon fill="black" stroke="black" points="462.5,-262.1 459,-252.1 455.5,-262.1 462.5,-262.1"/>
</g>
<!-- Br7 -->
<g id="node4" class="node">
<title>Br7</title>
<ellipse fill="none" stroke="black" cx="135" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="135" y="-158.3" font-family="Times,serif" font-size="14.00">8</text>
</g>
<!-- Br3&#45;&gt;Br7 -->
<g id="edge3" class="edge">
<title>Br3&#45;&gt;Br7</title>
<path fill="none" stroke="black" d="M224.19,-220.81C207,-209.67 181.38,-193.06 162.01,-180.5"/>
<polygon fill="black" stroke="black" points="163.89,-177.56 153.6,-175.05 160.08,-183.43 163.89,-177.56"/>
</g>
<!-- Br8 -->
<g id="node9" class="node">
<title>Br8</title>
<ellipse fill="none" stroke="black" cx="243" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="243" y="-158.3" font-family="Times,serif" font-size="14.00">12</text>
</g>
<!-- Br3&#45;&gt;Br8 -->
<g id="edge8" class="edge">
<title>Br3&#45;&gt;Br8</title>
<path fill="none" stroke="black" d="M243,-215.7C243,-207.98 243,-198.71 243,-190.11"/>
<polygon fill="black" stroke="black" points="246.5,-190.1 243,-180.1 239.5,-190.1 246.5,-190.1"/>
</g>
<!-- Br15 -->
<g id="node5" class="node">
<title>Br15</title>
<ellipse fill="none" stroke="black" cx="63" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="63" y="-86.3" font-family="Times,serif" font-size="14.00">16</text>
</g>
<!-- Br7&#45;&gt;Br15 -->
<g id="edge4" class="edge">
<title>Br7&#45;&gt;Br15</title>
<path fill="none" stroke="black" d="M120.43,-146.83C110.25,-136.94 96.48,-123.55 84.97,-112.36"/>
<polygon fill="black" stroke="black" points="87.41,-109.85 77.8,-105.38 82.53,-114.87 87.41,-109.85"/>
</g>
<!-- Lf16 -->
<g id="node8" class="node">
<title>Lf16</title>
<ellipse fill="none" stroke="black" cx="135" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="135" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br7&#45;&gt;Lf16 -->
<g id="edge7" class="edge">
<title>Br7&#45;&gt;Lf16</title>
<path fill="none" stroke="black" d="M135,-143.7C135,-135.98 135,-126.71 135,-118.11"/>
<polygon fill="black" stroke="black" points="138.5,-118.1 135,-108.1 131.5,-118.1 138.5,-118.1"/>
</g>
<!-- Lf31 -->
<g id="node6" class="node">
<title>Lf31</title>
<ellipse fill="none" stroke="black" cx="27" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br15&#45;&gt;Lf31 -->
<g id="edge5" class="edge">
<title>Br15&#45;&gt;Lf31</title>
<path fill="none" stroke="black" d="M54.65,-72.76C50.29,-64.28 44.85,-53.71 39.96,-44.2"/>
<polygon fill="black" stroke="black" points="42.99,-42.44 35.3,-35.15 36.77,-45.64 42.99,-42.44"/>
</g>
<!-- Lf32 -->
<g id="node7" class="node">
<title>Lf32</title>
<ellipse fill="none" stroke="black" cx="99" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br15&#45;&gt;Lf32 -->
<g id="edge6" class="edge">
<title>Br15&#45;&gt;Lf32</title>
<path fill="none" stroke="black" d="M71.35,-72.76C75.71,-64.28 81.15,-53.71 86.04,-44.2"/>
<polygon fill="black" stroke="black" points="89.23,-45.64 90.7,-35.15 83.01,-42.44 89.23,-45.64"/>
</g>
<!-- Lf17 -->
<g id="node10" class="node">
<title>Lf17</title>
<ellipse fill="none" stroke="black" cx="207" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="207" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br8&#45;&gt;Lf17 -->
<g id="edge9" class="edge">
<title>Br8&#45;&gt;Lf17</title>
<path fill="none" stroke="black" d="M234.65,-144.76C230.29,-136.28 224.85,-125.71 219.96,-116.2"/>
<polygon fill="black" stroke="black" points="222.99,-114.44 215.3,-107.15 216.77,-117.64 222.99,-114.44"/>
</g>
<!-- Lf18 -->
<g id="node11" class="node">
<title>Lf18</title>
<ellipse fill="none" stroke="black" cx="279" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="279" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br8&#45;&gt;Lf18 -->
<g id="edge10" class="edge">
<title>Br8&#45;&gt;Lf18</title>
<path fill="none" stroke="black" d="M251.35,-144.76C255.71,-136.28 261.15,-125.71 266.04,-116.2"/>
<polygon fill="black" stroke="black" points="269.23,-117.64 270.7,-107.15 263.01,-114.44 269.23,-117.64"/>
</g>
<!-- Br9 -->
<g id="node13" class="node">
<title>Br9</title>
<ellipse fill="none" stroke="black" cx="423" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="423" y="-158.3" font-family="Times,serif" font-size="14.00">10</text>
</g>
<!-- Br4&#45;&gt;Br9 -->
<g id="edge12" class="edge">
<title>Br4&#45;&gt;Br9</title>
<path fill="none" stroke="black" d="M450.65,-216.76C446.29,-208.28 440.85,-197.71 435.96,-188.2"/>
<polygon fill="black" stroke="black" points="438.99,-186.44 431.3,-179.15 432.77,-189.64 438.99,-186.44"/>
</g>
<!-- Br10 -->
<g id="node16" class="node">
<title>Br10</title>
<ellipse fill="none" stroke="black" cx="495" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="495" y="-158.3" font-family="Times,serif" font-size="14.00">14</text>
</g>
<!-- Br4&#45;&gt;Br10 -->
<g id="edge15" class="edge">
<title>Br4&#45;&gt;Br10</title>
<path fill="none" stroke="black" d="M467.35,-216.76C471.71,-208.28 477.15,-197.71 482.04,-188.2"/>
<polygon fill="black" stroke="black" points="485.23,-189.64 486.7,-179.15 479.01,-186.44 485.23,-189.64"/>
</g>
<!-- Lf19 -->
<g id="node14" class="node">
<title>Lf19</title>
<ellipse fill="none" stroke="black" cx="351" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="351" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br9&#45;&gt;Lf19 -->
<g id="edge13" class="edge">
<title>Br9&#45;&gt;Lf19</title>
<path fill="none" stroke="black" d="M408.43,-146.83C398.25,-136.94 384.48,-123.55 372.97,-112.36"/>
<polygon fill="black" stroke="black" points="375.41,-109.85 365.8,-105.38 370.53,-114.87 375.41,-109.85"/>
</g>
<!-- Lf20 -->
<g id="node15" class="node">
<title>Lf20</title>
<ellipse fill="none" stroke="black" cx="423" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="423" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br9&#45;&gt;Lf20 -->
<g id="edge14" class="edge">
<title>Br9&#45;&gt;Lf20</title>
<path fill="none" stroke="black" d="M423,-143.7C423,-135.98 423,-126.71 423,-118.11"/>
<polygon fill="black" stroke="black" points="426.5,-118.1 423,-108.1 419.5,-118.1 426.5,-118.1"/>
</g>
<!-- Lf21 -->
<g id="node17" class="node">
<title>Lf21</title>
<ellipse fill="none" stroke="black" cx="495" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="495" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br10&#45;&gt;Lf21 -->
<g id="edge16" class="edge">
<title>Br10&#45;&gt;Lf21</title>
<path fill="none" stroke="black" d="M495,-143.7C495,-135.98 495,-126.71 495,-118.11"/>
<polygon fill="black" stroke="black" points="498.5,-118.1 495,-108.1 491.5,-118.1 498.5,-118.1"/>
</g>
<!-- Lf22 -->
<g id="node18" class="node">
<title>Lf22</title>
<ellipse fill="none" stroke="black" cx="567" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="567" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br10&#45;&gt;Lf22 -->
<g id="edge17" class="edge">
<title>Br10&#45;&gt;Lf22</title>
<path fill="none" stroke="black" d="M509.57,-146.83C519.75,-136.94 533.52,-123.55 545.03,-112.36"/>
<polygon fill="black" stroke="black" points="547.47,-114.87 552.2,-105.38 542.59,-109.85 547.47,-114.87"/>
</g>
<!-- Br5 -->
<g id="node20" class="node">
<title>Br5</title>
<ellipse fill="none" stroke="black" cx="747" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="747" y="-230.3" font-family="Times,serif" font-size="14.00">5</text>
</g>
<!-- Br2&#45;&gt;Br5 -->
<g id="edge19" class="edge">
<title>Br2&#45;&gt;Br5</title>
<path fill="none" stroke="black" d="M747,-287.7C747,-279.98 747,-270.71 747,-262.11"/>
<polygon fill="black" stroke="black" points="750.5,-262.1 747,-252.1 743.5,-262.1 750.5,-262.1"/>
</g>
<!-- Br6 -->
<g id="node27" class="node">
<title>Br6</title>
<ellipse fill="none" stroke="black" cx="963" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="963" y="-230.3" font-family="Times,serif" font-size="14.00">7</text>
</g>
<!-- Br2&#45;&gt;Br6 -->
<g id="edge26" class="edge">
<title>Br2&#45;&gt;Br6</title>
<path fill="none" stroke="black" d="M770.94,-297.24C809.56,-284.73 885.72,-260.05 929.64,-245.81"/>
<polygon fill="black" stroke="black" points="930.85,-249.1 939.28,-242.69 928.69,-242.44 930.85,-249.1"/>
</g>
<!-- Br11 -->
<g id="node21" class="node">
<title>Br11</title>
<ellipse fill="none" stroke="black" cx="711" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="711" y="-158.3" font-family="Times,serif" font-size="14.00">9</text>
</g>
<!-- Br5&#45;&gt;Br11 -->
<g id="edge20" class="edge">
<title>Br5&#45;&gt;Br11</title>
<path fill="none" stroke="black" d="M738.65,-216.76C734.29,-208.28 728.85,-197.71 723.96,-188.2"/>
<polygon fill="black" stroke="black" points="726.99,-186.44 719.3,-179.15 720.77,-189.64 726.99,-186.44"/>
</g>
<!-- Br12 -->
<g id="node24" class="node">
<title>Br12</title>
<ellipse fill="none" stroke="black" cx="783" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="783" y="-158.3" font-family="Times,serif" font-size="14.00">13</text>
</g>
<!-- Br5&#45;&gt;Br12 -->
<g id="edge23" class="edge">
<title>Br5&#45;&gt;Br12</title>
<path fill="none" stroke="black" d="M755.35,-216.76C759.71,-208.28 765.15,-197.71 770.04,-188.2"/>
<polygon fill="black" stroke="black" points="773.23,-189.64 774.7,-179.15 767.01,-186.44 773.23,-189.64"/>
</g>
<!-- Lf23 -->
<g id="node22" class="node">
<title>Lf23</title>
<ellipse fill="none" stroke="black" cx="639" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="639" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br11&#45;&gt;Lf23 -->
<g id="edge21" class="edge">
<title>Br11&#45;&gt;Lf23</title>
<path fill="none" stroke="black" d="M696.43,-146.83C686.25,-136.94 672.48,-123.55 660.97,-112.36"/>
<polygon fill="black" stroke="black" points="663.41,-109.85 653.8,-105.38 658.53,-114.87 663.41,-109.85"/>
</g>
<!-- Lf24 -->
<g id="node23" class="node">
<title>Lf24</title>
<ellipse fill="none" stroke="black" cx="711" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="711" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br11&#45;&gt;Lf24 -->
<g id="edge22" class="edge">
<title>Br11&#45;&gt;Lf24</title>
<path fill="none" stroke="black" d="M711,-143.7C711,-135.98 711,-126.71 711,-118.11"/>
<polygon fill="black" stroke="black" points="714.5,-118.1 711,-108.1 707.5,-118.1 714.5,-118.1"/>
</g>
<!-- Lf25 -->
<g id="node25" class="node">
<title>Lf25</title>
<ellipse fill="none" stroke="black" cx="783" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="783" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br12&#45;&gt;Lf25 -->
<g id="edge24" class="edge">
<title>Br12&#45;&gt;Lf25</title>
<path fill="none" stroke="black" d="M783,-143.7C783,-135.98 783,-126.71 783,-118.11"/>
<polygon fill="black" stroke="black" points="786.5,-118.1 783,-108.1 779.5,-118.1 786.5,-118.1"/>
</g>
<!-- Lf26 -->
<g id="node26" class="node">
<title>Lf26</title>
<ellipse fill="none" stroke="black" cx="855" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="855" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br12&#45;&gt;Lf26 -->
<g id="edge25" class="edge">
<title>Br12&#45;&gt;Lf26</title>
<path fill="none" stroke="black" d="M797.57,-146.83C807.75,-136.94 821.52,-123.55 833.03,-112.36"/>
<polygon fill="black" stroke="black" points="835.47,-114.87 840.2,-105.38 830.59,-109.85 835.47,-114.87"/>
</g>
<!-- Br13 -->
<g id="node28" class="node">
<title>Br13</title>
<ellipse fill="none" stroke="black" cx="963" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="963" y="-158.3" font-family="Times,serif" font-size="14.00">11</text>
</g>
<!-- Br6&#45;&gt;Br13 -->
<g id="edge27" class="edge">
<title>Br6&#45;&gt;Br13</title>
<path fill="none" stroke="black" d="M963,-215.7C963,-207.98 963,-198.71 963,-190.11"/>
<polygon fill="black" stroke="black" points="966.5,-190.1 963,-180.1 959.5,-190.1 966.5,-190.1"/>
</g>
<!-- Br14 -->
<g id="node31" class="node">
<title>Br14</title>
<ellipse fill="none" stroke="black" cx="1071" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="1071" y="-158.3" font-family="Times,serif" font-size="14.00">15</text>
</g>
<!-- Br6&#45;&gt;Br14 -->
<g id="edge30" class="edge">
<title>Br6&#45;&gt;Br14</title>
<path fill="none" stroke="black" d="M981.81,-220.81C999,-209.67 1024.62,-193.06 1043.99,-180.5"/>
<polygon fill="black" stroke="black" points="1045.92,-183.43 1052.4,-175.05 1042.11,-177.56 1045.92,-183.43"/>
</g>
<!-- Lf27 -->
<g id="node29" class="node">
<title>Lf27</title>
<ellipse fill="none" stroke="black" cx="927" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="927" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br13&#45;&gt;Lf27 -->
<g id="edge28" class="edge">
<title>Br13&#45;&gt;Lf27</title>
<path fill="none" stroke="black" d="M954.65,-144.76C950.29,-136.28 944.85,-125.71 939.96,-116.2"/>
<polygon fill="black" stroke="black" points="942.99,-114.44 935.3,-107.15 936.77,-117.64 942.99,-114.44"/>
</g>
<!-- Lf28 -->
<g id="node30" class="node">
<title>Lf28</title>
<ellipse fill="none" stroke="black" cx="999" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="999" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br13&#45;&gt;Lf28 -->
<g id="edge29" class="edge">
<title>Br13&#45;&gt;Lf28</title>
<path fill="none" stroke="black" d="M971.35,-144.76C975.71,-136.28 981.15,-125.71 986.04,-116.2"/>
<polygon fill="black" stroke="black" points="989.23,-117.64 990.7,-107.15 983.01,-114.44 989.23,-117.64"/>
</g>
<!-- Lf29 -->
<g id="node32" class="node">
<title>Lf29</title>
<ellipse fill="none" stroke="black" cx="1071" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="1071" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br14&#45;&gt;Lf29 -->
<g id="edge31" class="edge">
<title>Br14&#45;&gt;Lf29</title>
<path fill="none" stroke="black" d="M1071,-143.7C1071,-135.98 1071,-126.71 1071,-118.11"/>
<polygon fill="black" stroke="black" points="1074.5,-118.1 1071,-108.1 1067.5,-118.1 1074.5,-118.1"/>
</g>
<!-- Lf30 -->
<g id="node33" class="node">
<title>Lf30</title>
<ellipse fill="none" stroke="black" cx="1143" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="1143" y="-86.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br14&#45;&gt;Lf30 -->
<g id="edge32" class="edge">
<title>Br14&#45;&gt;Lf30</title>
<path fill="none" stroke="black" d="M1085.57,-146.83C1095.75,-136.94 1109.52,-123.55 1121.03,-112.36"/>
<polygon fill="black" stroke="black" points="1123.47,-114.87 1128.2,-105.38 1118.59,-109.85 1123.47,-114.87"/>
</g>
</g>
</svg>
 %}
]}

{@ocaml[
let t =
  let list = List.init 15 (fun i -> i+1) in
  List.fold_left (fun t i -> update (t, i, i+1)) Lf list;;

let _ =
  printer string_of_int t;;
][
{%html: <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: D Pages: 1 -->
<svg width="1142pt" height="332pt"
 viewBox="0.00 0.00 1142.00 332.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>D</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-328 1138,-328 1138,4 -4,4"/>
<!-- Br0 -->
<g id="node1" class="node">
<title>Br0</title>
<ellipse fill="none" stroke="black" cx="603" cy="-306" rx="27" ry="18"/>
<text text-anchor="middle" x="603" y="-302.3" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- Br1 -->
<g id="node2" class="node">
<title>Br1</title>
<ellipse fill="none" stroke="black" cx="423" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="423" y="-230.3" font-family="Times,serif" font-size="14.00">3</text>
</g>
<!-- Br0&#45;&gt;Br1 -->
<g id="edge1" class="edge">
<title>Br0&#45;&gt;Br1</title>
<path fill="none" stroke="black" d="M580.2,-296.13C548.64,-283.86 491.46,-261.62 455.45,-247.62"/>
<polygon fill="black" stroke="black" points="456.48,-244.27 445.9,-243.9 453.95,-250.79 456.48,-244.27"/>
</g>
<!-- Br2 -->
<g id="node17" class="node">
<title>Br2</title>
<ellipse fill="none" stroke="black" cx="711" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="711" y="-230.3" font-family="Times,serif" font-size="14.00">4</text>
</g>
<!-- Br0&#45;&gt;Br2 -->
<g id="edge16" class="edge">
<title>Br0&#45;&gt;Br2</title>
<path fill="none" stroke="black" d="M621.81,-292.81C639,-281.67 664.62,-265.06 683.99,-252.5"/>
<polygon fill="black" stroke="black" points="685.92,-255.43 692.4,-247.05 682.11,-249.56 685.92,-255.43"/>
</g>
<!-- Br3 -->
<g id="node3" class="node">
<title>Br3</title>
<ellipse fill="none" stroke="black" cx="207" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="207" y="-158.3" font-family="Times,serif" font-size="14.00">5</text>
</g>
<!-- Br1&#45;&gt;Br3 -->
<g id="edge2" class="edge">
<title>Br1&#45;&gt;Br3</title>
<path fill="none" stroke="black" d="M399.06,-225.24C360.44,-212.73 284.28,-188.05 240.36,-173.81"/>
<polygon fill="black" stroke="black" points="241.31,-170.44 230.72,-170.69 239.15,-177.1 241.31,-170.44"/>
</g>
<!-- Br4 -->
<g id="node10" class="node">
<title>Br4</title>
<ellipse fill="none" stroke="black" cx="423" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="423" y="-158.3" font-family="Times,serif" font-size="14.00">7</text>
</g>
<!-- Br1&#45;&gt;Br4 -->
<g id="edge9" class="edge">
<title>Br1&#45;&gt;Br4</title>
<path fill="none" stroke="black" d="M423,-215.7C423,-207.98 423,-198.71 423,-190.11"/>
<polygon fill="black" stroke="black" points="426.5,-190.1 423,-180.1 419.5,-190.1 426.5,-190.1"/>
</g>
<!-- Br7 -->
<g id="node4" class="node">
<title>Br7</title>
<ellipse fill="none" stroke="black" cx="99" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-86.3" font-family="Times,serif" font-size="14.00">9</text>
</g>
<!-- Br3&#45;&gt;Br7 -->
<g id="edge3" class="edge">
<title>Br3&#45;&gt;Br7</title>
<path fill="none" stroke="black" d="M188.19,-148.81C171,-137.67 145.38,-121.06 126.01,-108.5"/>
<polygon fill="black" stroke="black" points="127.89,-105.56 117.6,-103.05 124.08,-111.43 127.89,-105.56"/>
</g>
<!-- Br8 -->
<g id="node7" class="node">
<title>Br8</title>
<ellipse fill="none" stroke="black" cx="207" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="207" y="-86.3" font-family="Times,serif" font-size="14.00">13</text>
</g>
<!-- Br3&#45;&gt;Br8 -->
<g id="edge6" class="edge">
<title>Br3&#45;&gt;Br8</title>
<path fill="none" stroke="black" d="M207,-143.7C207,-135.98 207,-126.71 207,-118.11"/>
<polygon fill="black" stroke="black" points="210.5,-118.1 207,-108.1 203.5,-118.1 210.5,-118.1"/>
</g>
<!-- Lf15 -->
<g id="node5" class="node">
<title>Lf15</title>
<ellipse fill="none" stroke="black" cx="27" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br7&#45;&gt;Lf15 -->
<g id="edge4" class="edge">
<title>Br7&#45;&gt;Lf15</title>
<path fill="none" stroke="black" d="M84.43,-74.83C74.25,-64.94 60.48,-51.55 48.97,-40.36"/>
<polygon fill="black" stroke="black" points="51.41,-37.85 41.8,-33.38 46.53,-42.87 51.41,-37.85"/>
</g>
<!-- Lf16 -->
<g id="node6" class="node">
<title>Lf16</title>
<ellipse fill="none" stroke="black" cx="99" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br7&#45;&gt;Lf16 -->
<g id="edge5" class="edge">
<title>Br7&#45;&gt;Lf16</title>
<path fill="none" stroke="black" d="M99,-71.7C99,-63.98 99,-54.71 99,-46.11"/>
<polygon fill="black" stroke="black" points="102.5,-46.1 99,-36.1 95.5,-46.1 102.5,-46.1"/>
</g>
<!-- Lf17 -->
<g id="node8" class="node">
<title>Lf17</title>
<ellipse fill="none" stroke="black" cx="171" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="171" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br8&#45;&gt;Lf17 -->
<g id="edge7" class="edge">
<title>Br8&#45;&gt;Lf17</title>
<path fill="none" stroke="black" d="M198.65,-72.76C194.29,-64.28 188.85,-53.71 183.96,-44.2"/>
<polygon fill="black" stroke="black" points="186.99,-42.44 179.3,-35.15 180.77,-45.64 186.99,-42.44"/>
</g>
<!-- Lf18 -->
<g id="node9" class="node">
<title>Lf18</title>
<ellipse fill="none" stroke="black" cx="243" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="243" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br8&#45;&gt;Lf18 -->
<g id="edge8" class="edge">
<title>Br8&#45;&gt;Lf18</title>
<path fill="none" stroke="black" d="M215.35,-72.76C219.71,-64.28 225.15,-53.71 230.04,-44.2"/>
<polygon fill="black" stroke="black" points="233.23,-45.64 234.7,-35.15 227.01,-42.44 233.23,-45.64"/>
</g>
<!-- Br9 -->
<g id="node11" class="node">
<title>Br9</title>
<ellipse fill="none" stroke="black" cx="387" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="387" y="-86.3" font-family="Times,serif" font-size="14.00">11</text>
</g>
<!-- Br4&#45;&gt;Br9 -->
<g id="edge10" class="edge">
<title>Br4&#45;&gt;Br9</title>
<path fill="none" stroke="black" d="M414.65,-144.76C410.29,-136.28 404.85,-125.71 399.96,-116.2"/>
<polygon fill="black" stroke="black" points="402.99,-114.44 395.3,-107.15 396.77,-117.64 402.99,-114.44"/>
</g>
<!-- Br10 -->
<g id="node14" class="node">
<title>Br10</title>
<ellipse fill="none" stroke="black" cx="459" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="459" y="-86.3" font-family="Times,serif" font-size="14.00">15</text>
</g>
<!-- Br4&#45;&gt;Br10 -->
<g id="edge13" class="edge">
<title>Br4&#45;&gt;Br10</title>
<path fill="none" stroke="black" d="M431.35,-144.76C435.71,-136.28 441.15,-125.71 446.04,-116.2"/>
<polygon fill="black" stroke="black" points="449.23,-117.64 450.7,-107.15 443.01,-114.44 449.23,-117.64"/>
</g>
<!-- Lf19 -->
<g id="node12" class="node">
<title>Lf19</title>
<ellipse fill="none" stroke="black" cx="315" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="315" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br9&#45;&gt;Lf19 -->
<g id="edge11" class="edge">
<title>Br9&#45;&gt;Lf19</title>
<path fill="none" stroke="black" d="M372.43,-74.83C362.25,-64.94 348.48,-51.55 336.97,-40.36"/>
<polygon fill="black" stroke="black" points="339.41,-37.85 329.8,-33.38 334.53,-42.87 339.41,-37.85"/>
</g>
<!-- Lf20 -->
<g id="node13" class="node">
<title>Lf20</title>
<ellipse fill="none" stroke="black" cx="387" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="387" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br9&#45;&gt;Lf20 -->
<g id="edge12" class="edge">
<title>Br9&#45;&gt;Lf20</title>
<path fill="none" stroke="black" d="M387,-71.7C387,-63.98 387,-54.71 387,-46.11"/>
<polygon fill="black" stroke="black" points="390.5,-46.1 387,-36.1 383.5,-46.1 390.5,-46.1"/>
</g>
<!-- Lf21 -->
<g id="node15" class="node">
<title>Lf21</title>
<ellipse fill="none" stroke="black" cx="459" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="459" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br10&#45;&gt;Lf21 -->
<g id="edge14" class="edge">
<title>Br10&#45;&gt;Lf21</title>
<path fill="none" stroke="black" d="M459,-71.7C459,-63.98 459,-54.71 459,-46.11"/>
<polygon fill="black" stroke="black" points="462.5,-46.1 459,-36.1 455.5,-46.1 462.5,-46.1"/>
</g>
<!-- Lf22 -->
<g id="node16" class="node">
<title>Lf22</title>
<ellipse fill="none" stroke="black" cx="531" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="531" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br10&#45;&gt;Lf22 -->
<g id="edge15" class="edge">
<title>Br10&#45;&gt;Lf22</title>
<path fill="none" stroke="black" d="M473.57,-74.83C483.75,-64.94 497.52,-51.55 509.03,-40.36"/>
<polygon fill="black" stroke="black" points="511.47,-42.87 516.2,-33.38 506.59,-37.85 511.47,-42.87"/>
</g>
<!-- Br5 -->
<g id="node18" class="node">
<title>Br5</title>
<ellipse fill="none" stroke="black" cx="711" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="711" y="-158.3" font-family="Times,serif" font-size="14.00">6</text>
</g>
<!-- Br2&#45;&gt;Br5 -->
<g id="edge17" class="edge">
<title>Br2&#45;&gt;Br5</title>
<path fill="none" stroke="black" d="M711,-215.7C711,-207.98 711,-198.71 711,-190.11"/>
<polygon fill="black" stroke="black" points="714.5,-190.1 711,-180.1 707.5,-190.1 714.5,-190.1"/>
</g>
<!-- Br6 -->
<g id="node25" class="node">
<title>Br6</title>
<ellipse fill="none" stroke="black" cx="927" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="927" y="-158.3" font-family="Times,serif" font-size="14.00">8</text>
</g>
<!-- Br2&#45;&gt;Br6 -->
<g id="edge24" class="edge">
<title>Br2&#45;&gt;Br6</title>
<path fill="none" stroke="black" d="M734.94,-225.24C773.56,-212.73 849.72,-188.05 893.64,-173.81"/>
<polygon fill="black" stroke="black" points="894.85,-177.1 903.28,-170.69 892.69,-170.44 894.85,-177.1"/>
</g>
<!-- Br11 -->
<g id="node19" class="node">
<title>Br11</title>
<ellipse fill="none" stroke="black" cx="675" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="675" y="-86.3" font-family="Times,serif" font-size="14.00">10</text>
</g>
<!-- Br5&#45;&gt;Br11 -->
<g id="edge18" class="edge">
<title>Br5&#45;&gt;Br11</title>
<path fill="none" stroke="black" d="M702.65,-144.76C698.29,-136.28 692.85,-125.71 687.96,-116.2"/>
<polygon fill="black" stroke="black" points="690.99,-114.44 683.3,-107.15 684.77,-117.64 690.99,-114.44"/>
</g>
<!-- Br12 -->
<g id="node22" class="node">
<title>Br12</title>
<ellipse fill="none" stroke="black" cx="747" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="747" y="-86.3" font-family="Times,serif" font-size="14.00">14</text>
</g>
<!-- Br5&#45;&gt;Br12 -->
<g id="edge21" class="edge">
<title>Br5&#45;&gt;Br12</title>
<path fill="none" stroke="black" d="M719.35,-144.76C723.71,-136.28 729.15,-125.71 734.04,-116.2"/>
<polygon fill="black" stroke="black" points="737.23,-117.64 738.7,-107.15 731.01,-114.44 737.23,-117.64"/>
</g>
<!-- Lf23 -->
<g id="node20" class="node">
<title>Lf23</title>
<ellipse fill="none" stroke="black" cx="603" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="603" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br11&#45;&gt;Lf23 -->
<g id="edge19" class="edge">
<title>Br11&#45;&gt;Lf23</title>
<path fill="none" stroke="black" d="M660.43,-74.83C650.25,-64.94 636.48,-51.55 624.97,-40.36"/>
<polygon fill="black" stroke="black" points="627.41,-37.85 617.8,-33.38 622.53,-42.87 627.41,-37.85"/>
</g>
<!-- Lf24 -->
<g id="node21" class="node">
<title>Lf24</title>
<ellipse fill="none" stroke="black" cx="675" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="675" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br11&#45;&gt;Lf24 -->
<g id="edge20" class="edge">
<title>Br11&#45;&gt;Lf24</title>
<path fill="none" stroke="black" d="M675,-71.7C675,-63.98 675,-54.71 675,-46.11"/>
<polygon fill="black" stroke="black" points="678.5,-46.1 675,-36.1 671.5,-46.1 678.5,-46.1"/>
</g>
<!-- Lf25 -->
<g id="node23" class="node">
<title>Lf25</title>
<ellipse fill="none" stroke="black" cx="747" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="747" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br12&#45;&gt;Lf25 -->
<g id="edge22" class="edge">
<title>Br12&#45;&gt;Lf25</title>
<path fill="none" stroke="black" d="M747,-71.7C747,-63.98 747,-54.71 747,-46.11"/>
<polygon fill="black" stroke="black" points="750.5,-46.1 747,-36.1 743.5,-46.1 750.5,-46.1"/>
</g>
<!-- Lf26 -->
<g id="node24" class="node">
<title>Lf26</title>
<ellipse fill="none" stroke="black" cx="819" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="819" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br12&#45;&gt;Lf26 -->
<g id="edge23" class="edge">
<title>Br12&#45;&gt;Lf26</title>
<path fill="none" stroke="black" d="M761.57,-74.83C771.75,-64.94 785.52,-51.55 797.03,-40.36"/>
<polygon fill="black" stroke="black" points="799.47,-42.87 804.2,-33.38 794.59,-37.85 799.47,-42.87"/>
</g>
<!-- Br13 -->
<g id="node26" class="node">
<title>Br13</title>
<ellipse fill="none" stroke="black" cx="927" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="927" y="-86.3" font-family="Times,serif" font-size="14.00">12</text>
</g>
<!-- Br6&#45;&gt;Br13 -->
<g id="edge25" class="edge">
<title>Br6&#45;&gt;Br13</title>
<path fill="none" stroke="black" d="M927,-143.7C927,-135.98 927,-126.71 927,-118.11"/>
<polygon fill="black" stroke="black" points="930.5,-118.1 927,-108.1 923.5,-118.1 930.5,-118.1"/>
</g>
<!-- Br14 -->
<g id="node29" class="node">
<title>Br14</title>
<ellipse fill="none" stroke="black" cx="1035" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="1035" y="-86.3" font-family="Times,serif" font-size="14.00">16</text>
</g>
<!-- Br6&#45;&gt;Br14 -->
<g id="edge28" class="edge">
<title>Br6&#45;&gt;Br14</title>
<path fill="none" stroke="black" d="M945.81,-148.81C963,-137.67 988.62,-121.06 1007.99,-108.5"/>
<polygon fill="black" stroke="black" points="1009.92,-111.43 1016.4,-103.05 1006.11,-105.56 1009.92,-111.43"/>
</g>
<!-- Lf27 -->
<g id="node27" class="node">
<title>Lf27</title>
<ellipse fill="none" stroke="black" cx="891" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="891" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br13&#45;&gt;Lf27 -->
<g id="edge26" class="edge">
<title>Br13&#45;&gt;Lf27</title>
<path fill="none" stroke="black" d="M918.65,-72.76C914.29,-64.28 908.85,-53.71 903.96,-44.2"/>
<polygon fill="black" stroke="black" points="906.99,-42.44 899.3,-35.15 900.77,-45.64 906.99,-42.44"/>
</g>
<!-- Lf28 -->
<g id="node28" class="node">
<title>Lf28</title>
<ellipse fill="none" stroke="black" cx="963" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="963" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br13&#45;&gt;Lf28 -->
<g id="edge27" class="edge">
<title>Br13&#45;&gt;Lf28</title>
<path fill="none" stroke="black" d="M935.35,-72.76C939.71,-64.28 945.15,-53.71 950.04,-44.2"/>
<polygon fill="black" stroke="black" points="953.23,-45.64 954.7,-35.15 947.01,-42.44 953.23,-45.64"/>
</g>
<!-- Lf29 -->
<g id="node30" class="node">
<title>Lf29</title>
<ellipse fill="none" stroke="black" cx="1035" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="1035" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br14&#45;&gt;Lf29 -->
<g id="edge29" class="edge">
<title>Br14&#45;&gt;Lf29</title>
<path fill="none" stroke="black" d="M1035,-71.7C1035,-63.98 1035,-54.71 1035,-46.11"/>
<polygon fill="black" stroke="black" points="1038.5,-46.1 1035,-36.1 1031.5,-46.1 1038.5,-46.1"/>
</g>
<!-- Lf30 -->
<g id="node31" class="node">
<title>Lf30</title>
<ellipse fill="none" stroke="black" cx="1107" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="1107" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br14&#45;&gt;Lf30 -->
<g id="edge30" class="edge">
<title>Br14&#45;&gt;Lf30</title>
<path fill="none" stroke="black" d="M1049.57,-74.83C1059.75,-64.94 1073.52,-51.55 1085.03,-40.36"/>
<polygon fill="black" stroke="black" points="1087.47,-42.87 1092.2,-33.38 1082.59,-37.85 1087.47,-42.87"/>
</g>
</g>
</svg>
 %}
]}






[
]

So the right-hand branch moves entirely to the left. The left-hand branch moves to the right, but the top node is removed.

{@ocaml[
let remove_top = 
  let rec loop = fun l r ->
    match l with
    | Lf -> Lf
    | Br (x, ll, lr) ->
      Br (x, r, loop ll lr)
  in
  function
  | Lf -> Lf
  | Br (_, ll, lr) -> loop ll lr

let t =
  let list = List.init 16 (fun i -> i+1) in
  List.fold_left (fun t i -> update (t, i, i)) Lf list;;

let _ =
  printer string_of_int (remove_top t);;
][
{%html: <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: D Pages: 1 -->
<svg width="1142pt" height="332pt"
 viewBox="0.00 0.00 1142.00 332.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>D</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-328 1138,-328 1138,4 -4,4"/>
<!-- Br0 -->
<g id="node1" class="node">
<title>Br0</title>
<ellipse fill="none" stroke="black" cx="603" cy="-306" rx="27" ry="18"/>
<text text-anchor="middle" x="603" y="-302.3" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- Br1 -->
<g id="node2" class="node">
<title>Br1</title>
<ellipse fill="none" stroke="black" cx="423" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="423" y="-230.3" font-family="Times,serif" font-size="14.00">3</text>
</g>
<!-- Br0&#45;&gt;Br1 -->
<g id="edge1" class="edge">
<title>Br0&#45;&gt;Br1</title>
<path fill="none" stroke="black" d="M580.2,-296.13C548.64,-283.86 491.46,-261.62 455.45,-247.62"/>
<polygon fill="black" stroke="black" points="456.48,-244.27 445.9,-243.9 453.95,-250.79 456.48,-244.27"/>
</g>
<!-- Br2 -->
<g id="node17" class="node">
<title>Br2</title>
<ellipse fill="none" stroke="black" cx="711" cy="-234" rx="27" ry="18"/>
<text text-anchor="middle" x="711" y="-230.3" font-family="Times,serif" font-size="14.00">4</text>
</g>
<!-- Br0&#45;&gt;Br2 -->
<g id="edge16" class="edge">
<title>Br0&#45;&gt;Br2</title>
<path fill="none" stroke="black" d="M621.81,-292.81C639,-281.67 664.62,-265.06 683.99,-252.5"/>
<polygon fill="black" stroke="black" points="685.92,-255.43 692.4,-247.05 682.11,-249.56 685.92,-255.43"/>
</g>
<!-- Br3 -->
<g id="node3" class="node">
<title>Br3</title>
<ellipse fill="none" stroke="black" cx="207" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="207" y="-158.3" font-family="Times,serif" font-size="14.00">5</text>
</g>
<!-- Br1&#45;&gt;Br3 -->
<g id="edge2" class="edge">
<title>Br1&#45;&gt;Br3</title>
<path fill="none" stroke="black" d="M399.06,-225.24C360.44,-212.73 284.28,-188.05 240.36,-173.81"/>
<polygon fill="black" stroke="black" points="241.31,-170.44 230.72,-170.69 239.15,-177.1 241.31,-170.44"/>
</g>
<!-- Br4 -->
<g id="node10" class="node">
<title>Br4</title>
<ellipse fill="none" stroke="black" cx="423" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="423" y="-158.3" font-family="Times,serif" font-size="14.00">7</text>
</g>
<!-- Br1&#45;&gt;Br4 -->
<g id="edge9" class="edge">
<title>Br1&#45;&gt;Br4</title>
<path fill="none" stroke="black" d="M423,-215.7C423,-207.98 423,-198.71 423,-190.11"/>
<polygon fill="black" stroke="black" points="426.5,-190.1 423,-180.1 419.5,-190.1 426.5,-190.1"/>
</g>
<!-- Br7 -->
<g id="node4" class="node">
<title>Br7</title>
<ellipse fill="none" stroke="black" cx="99" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-86.3" font-family="Times,serif" font-size="14.00">9</text>
</g>
<!-- Br3&#45;&gt;Br7 -->
<g id="edge3" class="edge">
<title>Br3&#45;&gt;Br7</title>
<path fill="none" stroke="black" d="M188.19,-148.81C171,-137.67 145.38,-121.06 126.01,-108.5"/>
<polygon fill="black" stroke="black" points="127.89,-105.56 117.6,-103.05 124.08,-111.43 127.89,-105.56"/>
</g>
<!-- Br8 -->
<g id="node7" class="node">
<title>Br8</title>
<ellipse fill="none" stroke="black" cx="207" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="207" y="-86.3" font-family="Times,serif" font-size="14.00">13</text>
</g>
<!-- Br3&#45;&gt;Br8 -->
<g id="edge6" class="edge">
<title>Br3&#45;&gt;Br8</title>
<path fill="none" stroke="black" d="M207,-143.7C207,-135.98 207,-126.71 207,-118.11"/>
<polygon fill="black" stroke="black" points="210.5,-118.1 207,-108.1 203.5,-118.1 210.5,-118.1"/>
</g>
<!-- Lf15 -->
<g id="node5" class="node">
<title>Lf15</title>
<ellipse fill="none" stroke="black" cx="27" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="27" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br7&#45;&gt;Lf15 -->
<g id="edge4" class="edge">
<title>Br7&#45;&gt;Lf15</title>
<path fill="none" stroke="black" d="M84.43,-74.83C74.25,-64.94 60.48,-51.55 48.97,-40.36"/>
<polygon fill="black" stroke="black" points="51.41,-37.85 41.8,-33.38 46.53,-42.87 51.41,-37.85"/>
</g>
<!-- Lf16 -->
<g id="node6" class="node">
<title>Lf16</title>
<ellipse fill="none" stroke="black" cx="99" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br7&#45;&gt;Lf16 -->
<g id="edge5" class="edge">
<title>Br7&#45;&gt;Lf16</title>
<path fill="none" stroke="black" d="M99,-71.7C99,-63.98 99,-54.71 99,-46.11"/>
<polygon fill="black" stroke="black" points="102.5,-46.1 99,-36.1 95.5,-46.1 102.5,-46.1"/>
</g>
<!-- Lf17 -->
<g id="node8" class="node">
<title>Lf17</title>
<ellipse fill="none" stroke="black" cx="171" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="171" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br8&#45;&gt;Lf17 -->
<g id="edge7" class="edge">
<title>Br8&#45;&gt;Lf17</title>
<path fill="none" stroke="black" d="M198.65,-72.76C194.29,-64.28 188.85,-53.71 183.96,-44.2"/>
<polygon fill="black" stroke="black" points="186.99,-42.44 179.3,-35.15 180.77,-45.64 186.99,-42.44"/>
</g>
<!-- Lf18 -->
<g id="node9" class="node">
<title>Lf18</title>
<ellipse fill="none" stroke="black" cx="243" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="243" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br8&#45;&gt;Lf18 -->
<g id="edge8" class="edge">
<title>Br8&#45;&gt;Lf18</title>
<path fill="none" stroke="black" d="M215.35,-72.76C219.71,-64.28 225.15,-53.71 230.04,-44.2"/>
<polygon fill="black" stroke="black" points="233.23,-45.64 234.7,-35.15 227.01,-42.44 233.23,-45.64"/>
</g>
<!-- Br9 -->
<g id="node11" class="node">
<title>Br9</title>
<ellipse fill="none" stroke="black" cx="387" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="387" y="-86.3" font-family="Times,serif" font-size="14.00">11</text>
</g>
<!-- Br4&#45;&gt;Br9 -->
<g id="edge10" class="edge">
<title>Br4&#45;&gt;Br9</title>
<path fill="none" stroke="black" d="M414.65,-144.76C410.29,-136.28 404.85,-125.71 399.96,-116.2"/>
<polygon fill="black" stroke="black" points="402.99,-114.44 395.3,-107.15 396.77,-117.64 402.99,-114.44"/>
</g>
<!-- Br10 -->
<g id="node14" class="node">
<title>Br10</title>
<ellipse fill="none" stroke="black" cx="459" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="459" y="-86.3" font-family="Times,serif" font-size="14.00">15</text>
</g>
<!-- Br4&#45;&gt;Br10 -->
<g id="edge13" class="edge">
<title>Br4&#45;&gt;Br10</title>
<path fill="none" stroke="black" d="M431.35,-144.76C435.71,-136.28 441.15,-125.71 446.04,-116.2"/>
<polygon fill="black" stroke="black" points="449.23,-117.64 450.7,-107.15 443.01,-114.44 449.23,-117.64"/>
</g>
<!-- Lf19 -->
<g id="node12" class="node">
<title>Lf19</title>
<ellipse fill="none" stroke="black" cx="315" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="315" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br9&#45;&gt;Lf19 -->
<g id="edge11" class="edge">
<title>Br9&#45;&gt;Lf19</title>
<path fill="none" stroke="black" d="M372.43,-74.83C362.25,-64.94 348.48,-51.55 336.97,-40.36"/>
<polygon fill="black" stroke="black" points="339.41,-37.85 329.8,-33.38 334.53,-42.87 339.41,-37.85"/>
</g>
<!-- Lf20 -->
<g id="node13" class="node">
<title>Lf20</title>
<ellipse fill="none" stroke="black" cx="387" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="387" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br9&#45;&gt;Lf20 -->
<g id="edge12" class="edge">
<title>Br9&#45;&gt;Lf20</title>
<path fill="none" stroke="black" d="M387,-71.7C387,-63.98 387,-54.71 387,-46.11"/>
<polygon fill="black" stroke="black" points="390.5,-46.1 387,-36.1 383.5,-46.1 390.5,-46.1"/>
</g>
<!-- Lf21 -->
<g id="node15" class="node">
<title>Lf21</title>
<ellipse fill="none" stroke="black" cx="459" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="459" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br10&#45;&gt;Lf21 -->
<g id="edge14" class="edge">
<title>Br10&#45;&gt;Lf21</title>
<path fill="none" stroke="black" d="M459,-71.7C459,-63.98 459,-54.71 459,-46.11"/>
<polygon fill="black" stroke="black" points="462.5,-46.1 459,-36.1 455.5,-46.1 462.5,-46.1"/>
</g>
<!-- Lf22 -->
<g id="node16" class="node">
<title>Lf22</title>
<ellipse fill="none" stroke="black" cx="531" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="531" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br10&#45;&gt;Lf22 -->
<g id="edge15" class="edge">
<title>Br10&#45;&gt;Lf22</title>
<path fill="none" stroke="black" d="M473.57,-74.83C483.75,-64.94 497.52,-51.55 509.03,-40.36"/>
<polygon fill="black" stroke="black" points="511.47,-42.87 516.2,-33.38 506.59,-37.85 511.47,-42.87"/>
</g>
<!-- Br5 -->
<g id="node18" class="node">
<title>Br5</title>
<ellipse fill="none" stroke="black" cx="711" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="711" y="-158.3" font-family="Times,serif" font-size="14.00">6</text>
</g>
<!-- Br2&#45;&gt;Br5 -->
<g id="edge17" class="edge">
<title>Br2&#45;&gt;Br5</title>
<path fill="none" stroke="black" d="M711,-215.7C711,-207.98 711,-198.71 711,-190.11"/>
<polygon fill="black" stroke="black" points="714.5,-190.1 711,-180.1 707.5,-190.1 714.5,-190.1"/>
</g>
<!-- Br6 -->
<g id="node25" class="node">
<title>Br6</title>
<ellipse fill="none" stroke="black" cx="927" cy="-162" rx="27" ry="18"/>
<text text-anchor="middle" x="927" y="-158.3" font-family="Times,serif" font-size="14.00">8</text>
</g>
<!-- Br2&#45;&gt;Br6 -->
<g id="edge24" class="edge">
<title>Br2&#45;&gt;Br6</title>
<path fill="none" stroke="black" d="M734.94,-225.24C773.56,-212.73 849.72,-188.05 893.64,-173.81"/>
<polygon fill="black" stroke="black" points="894.85,-177.1 903.28,-170.69 892.69,-170.44 894.85,-177.1"/>
</g>
<!-- Br11 -->
<g id="node19" class="node">
<title>Br11</title>
<ellipse fill="none" stroke="black" cx="675" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="675" y="-86.3" font-family="Times,serif" font-size="14.00">10</text>
</g>
<!-- Br5&#45;&gt;Br11 -->
<g id="edge18" class="edge">
<title>Br5&#45;&gt;Br11</title>
<path fill="none" stroke="black" d="M702.65,-144.76C698.29,-136.28 692.85,-125.71 687.96,-116.2"/>
<polygon fill="black" stroke="black" points="690.99,-114.44 683.3,-107.15 684.77,-117.64 690.99,-114.44"/>
</g>
<!-- Br12 -->
<g id="node22" class="node">
<title>Br12</title>
<ellipse fill="none" stroke="black" cx="747" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="747" y="-86.3" font-family="Times,serif" font-size="14.00">14</text>
</g>
<!-- Br5&#45;&gt;Br12 -->
<g id="edge21" class="edge">
<title>Br5&#45;&gt;Br12</title>
<path fill="none" stroke="black" d="M719.35,-144.76C723.71,-136.28 729.15,-125.71 734.04,-116.2"/>
<polygon fill="black" stroke="black" points="737.23,-117.64 738.7,-107.15 731.01,-114.44 737.23,-117.64"/>
</g>
<!-- Lf23 -->
<g id="node20" class="node">
<title>Lf23</title>
<ellipse fill="none" stroke="black" cx="603" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="603" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br11&#45;&gt;Lf23 -->
<g id="edge19" class="edge">
<title>Br11&#45;&gt;Lf23</title>
<path fill="none" stroke="black" d="M660.43,-74.83C650.25,-64.94 636.48,-51.55 624.97,-40.36"/>
<polygon fill="black" stroke="black" points="627.41,-37.85 617.8,-33.38 622.53,-42.87 627.41,-37.85"/>
</g>
<!-- Lf24 -->
<g id="node21" class="node">
<title>Lf24</title>
<ellipse fill="none" stroke="black" cx="675" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="675" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br11&#45;&gt;Lf24 -->
<g id="edge20" class="edge">
<title>Br11&#45;&gt;Lf24</title>
<path fill="none" stroke="black" d="M675,-71.7C675,-63.98 675,-54.71 675,-46.11"/>
<polygon fill="black" stroke="black" points="678.5,-46.1 675,-36.1 671.5,-46.1 678.5,-46.1"/>
</g>
<!-- Lf25 -->
<g id="node23" class="node">
<title>Lf25</title>
<ellipse fill="none" stroke="black" cx="747" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="747" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br12&#45;&gt;Lf25 -->
<g id="edge22" class="edge">
<title>Br12&#45;&gt;Lf25</title>
<path fill="none" stroke="black" d="M747,-71.7C747,-63.98 747,-54.71 747,-46.11"/>
<polygon fill="black" stroke="black" points="750.5,-46.1 747,-36.1 743.5,-46.1 750.5,-46.1"/>
</g>
<!-- Lf26 -->
<g id="node24" class="node">
<title>Lf26</title>
<ellipse fill="none" stroke="black" cx="819" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="819" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br12&#45;&gt;Lf26 -->
<g id="edge23" class="edge">
<title>Br12&#45;&gt;Lf26</title>
<path fill="none" stroke="black" d="M761.57,-74.83C771.75,-64.94 785.52,-51.55 797.03,-40.36"/>
<polygon fill="black" stroke="black" points="799.47,-42.87 804.2,-33.38 794.59,-37.85 799.47,-42.87"/>
</g>
<!-- Br13 -->
<g id="node26" class="node">
<title>Br13</title>
<ellipse fill="none" stroke="black" cx="927" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="927" y="-86.3" font-family="Times,serif" font-size="14.00">12</text>
</g>
<!-- Br6&#45;&gt;Br13 -->
<g id="edge25" class="edge">
<title>Br6&#45;&gt;Br13</title>
<path fill="none" stroke="black" d="M927,-143.7C927,-135.98 927,-126.71 927,-118.11"/>
<polygon fill="black" stroke="black" points="930.5,-118.1 927,-108.1 923.5,-118.1 930.5,-118.1"/>
</g>
<!-- Br14 -->
<g id="node29" class="node">
<title>Br14</title>
<ellipse fill="none" stroke="black" cx="1035" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="1035" y="-86.3" font-family="Times,serif" font-size="14.00">16</text>
</g>
<!-- Br6&#45;&gt;Br14 -->
<g id="edge28" class="edge">
<title>Br6&#45;&gt;Br14</title>
<path fill="none" stroke="black" d="M945.81,-148.81C963,-137.67 988.62,-121.06 1007.99,-108.5"/>
<polygon fill="black" stroke="black" points="1009.92,-111.43 1016.4,-103.05 1006.11,-105.56 1009.92,-111.43"/>
</g>
<!-- Lf27 -->
<g id="node27" class="node">
<title>Lf27</title>
<ellipse fill="none" stroke="black" cx="891" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="891" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br13&#45;&gt;Lf27 -->
<g id="edge26" class="edge">
<title>Br13&#45;&gt;Lf27</title>
<path fill="none" stroke="black" d="M918.65,-72.76C914.29,-64.28 908.85,-53.71 903.96,-44.2"/>
<polygon fill="black" stroke="black" points="906.99,-42.44 899.3,-35.15 900.77,-45.64 906.99,-42.44"/>
</g>
<!-- Lf28 -->
<g id="node28" class="node">
<title>Lf28</title>
<ellipse fill="none" stroke="black" cx="963" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="963" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br13&#45;&gt;Lf28 -->
<g id="edge27" class="edge">
<title>Br13&#45;&gt;Lf28</title>
<path fill="none" stroke="black" d="M935.35,-72.76C939.71,-64.28 945.15,-53.71 950.04,-44.2"/>
<polygon fill="black" stroke="black" points="953.23,-45.64 954.7,-35.15 947.01,-42.44 953.23,-45.64"/>
</g>
<!-- Lf29 -->
<g id="node30" class="node">
<title>Lf29</title>
<ellipse fill="none" stroke="black" cx="1035" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="1035" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br14&#45;&gt;Lf29 -->
<g id="edge29" class="edge">
<title>Br14&#45;&gt;Lf29</title>
<path fill="none" stroke="black" d="M1035,-71.7C1035,-63.98 1035,-54.71 1035,-46.11"/>
<polygon fill="black" stroke="black" points="1038.5,-46.1 1035,-36.1 1031.5,-46.1 1038.5,-46.1"/>
</g>
<!-- Lf30 -->
<g id="node31" class="node">
<title>Lf30</title>
<ellipse fill="none" stroke="black" cx="1107" cy="-18" rx="27" ry="18"/>
<text text-anchor="middle" x="1107" y="-14.3" font-family="Times,serif" font-size="14.00">Lf</text>
</g>
<!-- Br14&#45;&gt;Lf30 -->
<g id="edge30" class="edge">
<title>Br14&#45;&gt;Lf30</title>
<path fill="none" stroke="black" d="M1049.57,-74.83C1059.75,-64.94 1073.52,-51.55 1085.03,-40.36"/>
<polygon fill="black" stroke="black" points="1087.47,-42.87 1092.2,-33.38 1082.59,-37.85 1087.47,-42.87"/>
</g>
</g>
</svg>
 %}
]}

{1 Lecture 8}

{2 Exercise 8.1}

What does the following function do, and what are its uses?

{@ocaml[let sw f x y = f y x]}

Switches the order of arguments around. Most useful for partial application of functions where the argument you want to apply isn't the first one.

{2 Exercise 8.2}

There are many ways of combining orderings. The lexicographic ordering uses two keys for comparisons. It is specified by
(𝑥′,𝑦′)<(𝑥,𝑦)⟺𝑥′<𝑥∨(𝑥′=𝑥∧𝑦′<𝑦).
Write an OCaml function to lexicographically combine two orderings, supplied as functions. Explain how it allows function insort to sort a list of pairs.

This implementation avoids polymorphic comparison, and assumes .

{@ocaml[
# type 'a sort_fn = 'a -> 'a -> bool;;
type 'a sort_fn = 'a -> 'a -> bool
# let lex_sort : 'a sort_fn -> 'b sort_fn -> ('a * 'b) sort_fn = fun sort_a sort_b (a,b) (a',b') ->
    sort_a a a' || (not (sort_a a' a) && sort_b b b');;
val lex_sort : 'a sort_fn -> 'b sort_fn -> ('a * 'b) sort_fn = <fun>
# let lexii : (int * int) sort_fn = lex_sort (<) (<);;
val lexii : (int * int) sort_fn = <fun>
# lexii (1,0) (2,0);;
- : bool = true
# lexii (1,1) (1,2);;
- : bool = true
# lexii (1,2) (1,1);;
- : bool = false
# lexii (2,1) (1,2);;
- : bool = false
]}


{@ocaml[
# let insort lessequal =
  let rec ins x = function
    | [] -> [x]
    | y::ys -> if lessequal x y then x :: y :: ys
               else y :: ins x ys
  in
  let rec sort = function
    | [] -> []
    | x::xs -> ins x (sort xs)
  in
  sort;;
val insort : ('a -> 'a -> bool) -> 'a list -> 'a list = <fun>
# let pairs = List.init 100 (fun _ -> (Random.int 10, Random.int 10));;
val pairs : (int * int) list =
  [(2, 4); (5, 0); (1, 6); (7, 5); (4, 3); (5, 8); (4, 4); (8, 6); (8, 0);
   (8, 6); (9, 4); (6, 6); (4, 7); (2, 4); (6, 2); (5, 7); (7, 7); (0, 6);
   (0, 7); (6, 2); (7, 1); (8, 7); (2, 7); (4, 3); (4, 8); (7, 0); (7, 8);
   (7, 4); (7, 1); (1, 7); (6, 1); (2, 3); (7, 1); (3, 5); (3, 9); (9, 3);
   (5, 4); (7, 6); (0, 3); (4, 3); (4, 3); (9, 6); (1, 9); (1, 1); (6, 3);
   (5, 7); (7, 7); (7, 6); (7, 8); (9, 5); (4, 5); (1, 3); (0, 2); (2, 7);
   (7, 1); (9, 4); (9, 9); (4, 7); (7, 8); (2, 6); (7, 8); (7, 1); (3, 8);
   (5, 1); (2, 3); (0, 9); (0, 6); (1, 2); (8, 9); (5, 5); (9, 3); (2, 6);
   (7, 7); (0, 7); (5, 9); (0, 9); (8, 4); (5, 1); (2, 4); (5, 4); (2, 4);
   (0, 7); (7, 0); (4, 4); (2, 2); (3, 9); (9, 5); (9, 5); (3, 0); (1, 6);
   (9, 9); (8, 2); (2, 2); (9, 1); (6, 2); (3, 7); (5, 3); (1, 3); (6, 0);
   (2, ...); ...]
# insort lexii pairs;;
- : (int * int) list =
[(0, 2); (0, 3); (0, 6); (0, 6); (0, 7); (0, 7); (0, 7); (0, 9); (0, 9);
 (1, 1); (1, 2); (1, 3); (1, 3); (1, 6); (1, 6); (1, 7); (1, 9); (2, 2);
 (2, 2); (2, 3); (2, 3); (2, 4); (2, 4); (2, 4); (2, 4); (2, 6); (2, 6);
 (2, 7); (2, 7); (2, 8); (3, 0); (3, 5); (3, 7); (3, 8); (3, 9); (3, 9);
 (4, 3); (4, 3); (4, 3); (4, 3); (4, 4); (4, 4); (4, 5); (4, 7); (4, 7);
 (4, 8); (5, 0); (5, 1); (5, 1); (5, 3); (5, 4); (5, 4); (5, 5); (5, 7);
 (5, 7); (5, 8); (5, 9); (6, 0); (6, 1); (6, 2); (6, 2); (6, 2); (6, 3);
 (6, 6); (7, 0); (7, 0); (7, 1); (7, 1); (7, 1); (7, 1); (7, 1); (7, 4);
 (7, 5); (7, 6); (7, 6); (7, 7); (7, 7); (7, 7); (7, 8); (7, 8); (7, 8);
 (7, 8); (8, 0); (8, 2); (8, 4); (8, 6); (8, 6); (8, 7); (8, 9); (9, 1);
 (9, 3); (9, 3); (9, 4); (9, 4); (9, 5); (9, 5); (9, 5); (9, 6); (9, 9);
 (9, ...); ...]
]}

{2 Exercise 8.3}

{@ocaml[
let rec map2 f = function
  | [] -> []
  | [] :: xss -> [] :: map2 f xss
  | (x :: xs) :: xss ->
    match map2 f (xs :: xss) with
    | [] -> [] (* Doesn't happen! *)
    | xs' :: xss' ->
        (f x :: xs') :: xss'
]}

{@ocaml[
# let x = map2 (fun x -> x + 1) [[1;2;3];[4;5;6];[7;8;9]];;
val x : int list list = [[2; 3; 4]; [5; 6; 7]; [8; 9; 10]]
]}

{2 Exercise 8.4}

{@ocaml[
# let opt_map f o =
    match o with
    | Some x -> Some (f x)
    | None -> None;;
val opt_map : ('a -> 'b) -> 'a option -> 'b option = <fun>
# opt_map (fun x -> x + 1) None;;
- : int option = None
# opt_map (fun x -> x + 1) (Some 4);;
- : int option = Some 5
]}

{2 Exercise 8.5}

Recall the making change function of Lecture 4:

{@ocaml[
let rec change till amt =
  match till, amt with
  | _       , 0   -> [ [] ]
  | []      , _   -> []
  | c::till , amt -> if amt < c then change till amt
                    else let rec allc = function
                           | [] -> []
                           | cs :: css -> (c::cs) :: allc css
                         in
                           allc (change (c::till) (amt - c)) @
                                 change till amt
]}

Function allc applies the function [cons a c] to every element of a list. Eliminate it by declaring a curried cons function and applying map.

{@ocaml[
# let cons c xs = c :: xs;;
val cons : 'a -> 'a list -> 'a list = <fun>

# let rec change till amt =
  match till, amt with
  | _       , 0   -> [ [] ]
  | []      , _   -> []
  | c::till , amt -> if amt < c then change till amt
                    else 
                           List.map (cons c) (change (c::till) (amt - c)) @
                                 change till amt;;
val change : int list -> int -> int list list = <fun>
# change [1;2;5] 10;;
- : int list list =
[[1; 1; 1; 1; 1; 1; 1; 1; 1; 1]; [1; 1; 1; 1; 1; 1; 1; 1; 2];
 [1; 1; 1; 1; 1; 1; 2; 2]; [1; 1; 1; 1; 1; 5]; [1; 1; 1; 1; 2; 2; 2];
 [1; 1; 1; 2; 5]; [1; 1; 2; 2; 2; 2]; [1; 2; 2; 5]; [2; 2; 2; 2; 2];
 [5; 5]]
]}

{1 Lecture 9}

{@ocaml[
type 'a seq =
| Nil
| Cons of 'a * (unit -> 'a seq)

let head = function
  | Cons (x, _) -> x
  | Nil -> failwith "head: Sequence is nil"

let tail = function
  | Cons (_, xf) -> xf ()
  | Nil -> failwith "head: Sequence is nil"
]}

{2 Exercise 9.1}

Code an analogue of map for sequences.

{@ocaml[
let rec map f = function
  | Nil -> Nil
  | Cons (x, xf) -> Cons (f x, fun () -> map f (xf ()))
]}

{@ocaml[
# let rec integers start = Cons (start, fun () -> integers (start + 1));;
val integers : int -> int seq = <fun>
# let rec take n seq = match n with 0 -> [] | _ -> head seq :: take (n-1) (tail seq);;
val take : int -> 'a seq -> 'a list = <fun>
# let x = take 10 (integers 0);;
val x : int list = [0; 1; 2; 3; 4; 5; 6; 7; 8; 9]
# let x = take 10 (map (fun x -> x * 2) (integers 0));;
val x : int list = [0; 2; 4; 6; 8; 10; 12; 14; 16; 18]
]}


{2 Exercise 9.2}

{@ocaml[
let rec seq_concat ss =
    match ss with
    | Nil -> Nil
    | Cons (Nil, ssf) -> seq_concat (ssf ())
    | Cons (Cons (v, sf), ssf) -> Cons (v, fun () -> seq_concat (Cons (sf (), ssf)));;
]}

{@ocaml[
# let rec ints x y f = if x=y then Nil else Cons (f x, fun () -> ints (x+1) y f);;
val ints : int -> int -> (int -> 'a) -> 'a seq = <fun>
# let ints3 x = ints x (x+3) (fun i -> i);;
val ints3 : int -> int seq = <fun>
# let seq = ints 0 5 ints3;;
val seq : int seq seq = Cons (Cons (0, <fun>), <fun>)
# let seqc = seq_concat seq;;
val seqc : int seq = Cons (0, <fun>)
# let x = take 10 seqc;;
val x : int list = [0; 1; 2; 1; 2; 3; 2; 3; 4; 3]
]}

This works well if the sequences are all finite, but if any is infinite we'll never get any further.

{2 Exercise 9.3}

N.b. the following append is slightly different than that presented in the lectures. In particular,
the [yq] argument has type [unit -> 'a queue].

{@ocaml[
let rec appendq xq yq =
  match xq with
  | Nil -> yq ()
  | Cons (x, xf) -> Cons(x, fun () -> appendq (xf ()) yq)

let rec change (till,amt) =
  match till, amt with
  | _       , 0   -> Cons( [], fun () -> Nil )
  | []      , _   -> Nil
  | c::till , amt -> if amt < c then change (till,amt)
                    else 
                        appendq (map (fun x -> c :: x) (change ((c::till), (amt - c))))
                                 (fun () -> change (till,amt))
]}

To confirm that we're not eagerly evaluating the entire sequence accidentally, let's trace it.
Additionally we'll convert the [change] function to take a pair rather than being curried,
just to make the trace easier to read.

{@ocaml[
# #trace change;;
change is now traced.
# let chg = change ([2;1],5);;
change <-- ([2; 1], 5)
change <-- ([2; 1], 3)
change <-- ([2; 1], 1)
change <-- ([1], 1)
change <-- ([1], 0)
change --> Cons ([], <fun>)
change --> Cons ([1], <fun>)
change --> Cons ([1], <fun>)
change --> Cons ([2; 1], <fun>)
change --> Cons ([2; 2; 1], <fun>)
val chg : int list seq = Cons ([2; 2; 1], <fun>)
# let mytest = take 1 chg;; (* take some change *);;
change <-- ([], 1)
change --> Nil
change <-- ([1], 3)
change <-- ([1], 2)
change <-- ([1], 1)
change <-- ([1], 0)
change --> Cons ([], <fun>)
change --> Cons ([1], <fun>)
change --> Cons ([1; 1], <fun>)
change --> Cons ([1; 1; 1], <fun>)
val mytest : int list list = [[2; 2; 1]]
]}

This following function more closely follows the 'efficient' [change] function.

{@ocaml[
let rec change (till,amt,chg,chgs) =
  match till, amt with
  | _       , 0   -> Cons (chg, chgs)
  | []      , _   -> chgs ()
  | c::till , amt -> if amt < 0 then chgs ()
                     else change ((c::till), (amt - c), (c::chg),
                                 (fun () -> change (till, amt, chg, chgs)))
]}

And let's check this one isn't eager too.

{@ocaml[
# #trace change;;
change is now traced.
# let chg = (change ([5;2;1], 20, [], (fun () -> Nil)));;
change <-- ([5; 2; 1], 20, [], <fun>)
change <-- ([5; 2; 1], 15, [5], <fun>)
change <-- ([5; 2; 1], 10, [5; 5], <fun>)
change <-- ([5; 2; 1], 5, [5; 5; 5], <fun>)
change <-- ([5; 2; 1], 0, [5; 5; 5; 5], <fun>)
change --> Cons ([5; 5; 5; 5], <fun>)
change --> Cons ([5; 5; 5; 5], <fun>)
change --> Cons ([5; 5; 5; 5], <fun>)
change --> Cons ([5; 5; 5; 5], <fun>)
change --> Cons ([5; 5; 5; 5], <fun>)
val chg : int list seq = Cons ([5; 5; 5; 5], <fun>)
]}

{2 Exercise 9.4}

A lazy binary tree is either empty or is a branch containing a label and two lazy
binary trees, possibly to infinite depth. Present an OCaml datatype to represent
lazy binary trees, along with a function that accepts a lazy binary tree and produces
a lazy list that contains all of the tree’s labels. (Taken from the exam question
2008 Paper 1 Question 5.)

{@ocaml[
type 'a ltree =
    Lf
  | Br of 'a * (unit -> 'a ltree) * (unit -> 'a ltree)

let rec labels = function
  | Lf -> Nil
  | Br (x, l, r) -> Cons (x, fun () ->
    let sl = labels (l ()) in
    let sr = fun () -> labels (r ()) in
    appendq sl sr) (* preorder *)
]}


{@ocaml[
# let rec ftree k n =
    if n = 0 then Lf
    else Br (k, (fun () -> ftree (2 * k) (n - 1)), (fun () -> ftree (2 * k + 1) (n - 1)));;
val ftree : int -> int -> int ltree = <fun>
# #trace labels;;
labels is now traced.
# let t = ftree 1 4;;
val t : int ltree = Br (1, <fun>, <fun>)
# let ls = labels t;;
labels <-- Br (<poly>, <fun>, <fun>)
labels --> Cons (<poly>, <fun>)
val ls : int seq = Cons (1, <fun>)
# let _ = take 3 ls;;
labels <-- Br (<poly>, <fun>, <fun>)
labels --> Cons (<poly>, <fun>)
labels <-- Br (<poly>, <fun>, <fun>)
labels --> Cons (<poly>, <fun>)
labels <-- Br (<poly>, <fun>, <fun>)
labels --> Cons (<poly>, <fun>)
- : int list = [1; 2; 4]
]}

{2 Exercise 9.5}

Code the lazy list whose elements are all ordinary lists of zeroes and ones, namely
{v []; [0]; [1]; [0; 0]; [0; 1]; [1; 0]; [1; 1]; [0; 0; 0];
v}
(Taken from the exam question 2003 Paper 1 Question 5.)

{@ocaml[
let rec interleave xq yq =
  match xq with
  | Nil -> yq
  | Cons (x, xf) -> Cons (x, fun () -> interleave yq (xf ()))

let rec seq cur = Cons (cur, fun () -> interleave (seq (0::cur)) (seq (1::cur)));;

let rec seq2f = function
    | Nil -> Nil
    | Cons (x, xf) -> Cons (0 :: x, fun () -> Cons (1 :: x, fun () -> seq2f (xf ())))
let rec seq2 = Cons ([], fun () -> seq2f seq2);;
]}


{@ocaml[
# take 10 (seq []);;
- : int list list =
[[]; [0]; [1]; [0; 0]; [0; 1]; [1; 0]; [1; 1]; [0; 0; 0]; [0; 0; 1];
 [0; 1; 0]]
# take 10 seq2;;
- : int list list =
[[]; [0]; [1]; [0; 0]; [1; 0]; [0; 1]; [1; 1]; [0; 0; 0]; [1; 0; 0];
 [0; 1; 0]]
]}


{2 Exercise 9.6}

(Continuing the previous exercise.) A palindrome is a list that equals its own reverse.
Code the lazy list whose elements are all palindromes of 0s and 1s, namely
{v
[]; [0]; [1]; [0; 0]; [0; 0; 0]; [0; 1; 0]; [1; 1]; [1; 0; 1]; [1; 1; 1]; [0; 0; 0; 0];, …
v}
You may take the reversal function List.rev as given.

{@ocaml[
# let rec filterq f = function
    | Nil -> Nil
    | Cons (x, xf) -> if f x then Cons (x, fun () -> filterq f (xf ())) else filterq f (xf ());;
val filterq : ('a -> bool) -> 'a seq -> 'a seq = <fun>
# let filter l = l = List.rev l;;
val filter : 'a list -> bool = <fun>
# let y = take 10 (filterq filter seq2);;
val y : int list list =
  [[]; [0]; [1]; [0; 0]; [1; 1]; [0; 0; 0]; [0; 1; 0]; [1; 0; 1]; [1; 1; 1];
   [0; 0; 0; 0]]
]}
